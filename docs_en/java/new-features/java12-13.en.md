---
title: Overview of new features in Java 12 & 13
category: Java
tag:
  - Java new features
head:
  - - meta
    - name: keywords
      content: Java 12, Java 13, string enhancement, switching expressions, garbage collection, JEP
  - - meta
    - name: description
      content: Summarizes the feature updates of JDK 12/13, including string enhancements, switch improvements, GC adjustments, etc.
---

##Java12

### String enhancement

Java 12 adds two string processing methods, as shown below.

The `indent()` method can implement string indentation.

```java
String text = "Java";
//Indent 4 spaces
text = text.indent(4);
System.out.println(text);
text = text.indent(-10);
System.out.println(text);
```

Output:

```plain
     Java
Java
```

The `transform()` method can be used to transform the specified string.

```java
String result = "foo".transform(input -> input + " bar");
System.out.println(result); // foo bar
```

### Files enhancement (file comparison)

Java 12 added the following methods to compare two files:

```java
public static long mismatch(Path path, Path path2) throws IOException
```

The `mismatch()` method compares two files and returns the position of the first mismatched character, or -1L if the files are identical.

Code example (case where two files have the same content):

```java
Path filePath1 = Files.createTempFile("file1", ".txt");
Path filePath2 = Files.createTempFile("file2", ".txt");
Files.writeString(filePath1, "Java 12 Article");
Files.writeString(filePath2, "Java 12 Article");

long mismatch = Files.mismatch(filePath1, filePath2);
assertEquals(-1, mismatch);
```

Code example (when the contents of the two files are not the same):

```java
Path filePath3 = Files.createTempFile("file3", ".txt");
Path filePath4 = Files.createTempFile("file4", ".txt");
Files.writeString(filePath3, "Java 12 Article");
Files.writeString(filePath4, "Java 12 Tutorial");

long mismatch = Files.mismatch(filePath3, filePath4);
assertEquals(8, mismatch);
```

### Number formatting tool class

`NumberFormat` adds support for formatting complex numbers

```java
NumberFormat fmt = NumberFormat.getCompactNumberInstance(Locale.US, NumberFormat.Style.SHORT);
String result = fmt.format(1000);
System.out.println(result);
```

Output:

```plain
1K
```

### Shenandoah GC

The main goal of the Pauseless GC implementation developed by Redhat is that 99.9% of pauses are less than 10ms, and the pauses have nothing to do with the heap size, etc.

Compared with Java11 open source ZGC (which needs to be upgraded to JDK11 before it can be used), Shenandoah GC has a stable JDK8u version, which is more feasible today when Java8 occupies the main market share.

### G1 collector optimization

Java12 brings two updates to the default garbage collector G1:

- **Abortable Mixed Collection Set**: An implementation of JEP 344 that enables the G1 garbage collector to abort the garbage collection process by splitting the set of regions to be collected (mixed collection set) into mandatory and optional parts in order to achieve user-supplied pause time goals. G1 can abort optional portions of collection to meet pause time goals
- **Prompt return of unused allocated memory**: Implementation of JEP346, enhancing the G1 GC to automatically return Java heap memory to the operating system when idle

### Preview new features

To add as a preview feature, you need to add the parameter `--enable-preview` when compiling `javac` and running `java`.

#### Enhance Switch

The traditional `switch` syntax has the problem of easily missing `break`, and from the perspective of code cleanliness, multiple breaks are essentially repetitive.

Java12 enhances the `switch` expression, using lambda-like syntax to execute the block after successful condition matching, without the need to write more break.

```java
switch (day) {
    case MONDAY, FRIDAY, SUNDAY -> System.out.println(6);
    case TUESDAY -> System.out.println(7);
    case THURSDAY, SATURDAY -> System.out.println(8);
    case WEDNESDAY -> System.out.println(9);
}
```

#### instanceof pattern matching

`instanceof` mainly detects the specific type of the object before type cast.

In previous versions, we needed to explicitly cast the object.

```java
Object obj = "I am a string";
if(obj instanceof String){
   String str = (String) obj;
  System.out.println(str);
}
```

The new version of `instanceof` can complete the conversion while determining whether it belongs to a specific type.

```java
Object obj = "I am a string";
if(obj instanceof String str){
  System.out.println(str);
}
```

##Java13

### Enhance ZGC (release unused memory)

ZGC, which was experimentally introduced in Java 11, has the problem of failing to proactively release unused memory to the operating system in actual use.

The ZGC heap consists of a set of heap regions called ZPages. When the ZPages area is cleared during a GC cycle, they are released and returned to the page cache **ZPageCache**. ZPages in this cache are organized in least recently used (LRU) order and organized by size.

In Java 13, ZGC will return pages identified as unused for a long time to the operating system so that they can be reused by other processes.

### SocketAPI Refactoring

The Java Socket API finally gets a major update!

Java 13 rewrites the bottom layer of the Socket API. `NioSocketImpl` is a direct replacement for `PlainSocketImpl`. It uses locks under the `java.util.concurrent` package instead of synchronized methods. If you want to use the old implementation, use `-Djdk.net.usePlainSocketImpl=true`.

And, in Java 13, the new Socket implementation is used by default.

```java
public final class NioSocketImpl extends SocketImpl implements PlatformSocketImpl {
}
```

### FileSystems

The following three new methods have been added to the `FileSystems` class to make it easier to use file system providers that treat file contents as a file system:

- `newFileSystem(Path)`
- `newFileSystem(Path, Map<String, ?>)`
- `newFileSystem(Path, Map<String, ?>, ClassLoader)`

### Dynamic CDS Archive

Java 13 further simplifies, improves and expands the Application Class Data Sharing (AppCDS) introduced in Java 10, namely: **Allows dynamic class archiving at the end of Java application execution**. Specifically, the classes that can be archived include all application classes that have been loaded but do not belong to the default base CDS and classes in reference class libraries.

This improves the availability of Application Class Data Sharing ([AppCDS](https://openjdk.java.net/jeps/310)). Users are not required to perform a trial run to create a class list for each application.

```bash
java -XX:ArchiveClassesAtExit=my_app_cds.jsa -cp my_app.jar
java -XX:SharedArchiveFile=my_app_cds.jsa -cp my_app.jar```

### Preview new features

#### Text block

To solve the problem that Java can only support newline escape or newline connection when defining multi-line strings, **triple double quotes** are introduced to define multi-line text.

Java 13 supports that anything between two `"""` symbols will be interpreted as part of the string, including newlines.

HTML writing before text blocks are not supported:

```java
String json="{\n" +
              " \"name\":\"mkyong\",\n" +
              " \"age\":38\n" +
              "}\n";
```

Supports HTML writing after text blocks:

```java
 String json = """
                {
                    "name":"mkyong",
                    "age":38
                }
                """;
```

SQL writing before text blocks were not supported:

```sql
String query = "SELECT `EMP_ID`, `LAST_NAME` FROM `EMPLOYEE_TB`\n" +
               "WHERE `CITY` = 'INDIANAPOLIS'\n" +
               "ORDER BY `EMP_ID`, `LAST_NAME`;\n";
```

Supports SQL writing after text block:

```sql
String query = """
               SELECT `EMP_ID`, `LAST_NAME` FROM `EMPLOYEE_TB`
               WHERE `CITY` = 'INDIANAPOLIS'
               ORDER BY `EMP_ID`, `LAST_NAME`;
               """;
```

In addition, the `String` class adds 3 new methods to operate text blocks:

- `formatted(Object... args)`: It is similar to the `format()` method of `String`. It was added to support formatting of text blocks.
- `stripIndent()`: used to remove spaces at the beginning and end of each line in a text block.
- `translateEscapes()`: Escape sequences such as _"\\\t"_ are converted to _"\t"_

Since text blocks are a preview feature that may be removed in a future release, these new methods are marked as deprecated.

```java
@Deprecated(forRemoval=true, since="13")
public String stripIndent() {
}
@Deprecated(forRemoval=true, since="13")
public String formatted(Object... args) {

}
@Deprecated(forRemoval=true, since="13")
public String translateEscapes() {
}
```

#### Enhance Switch (introduce yield keyword into Switch)

There is an additional keyword in the `Switch` expression, which is used to jump out of the `Switch` block. The keyword `yield` is mainly used to return a value.

The difference between `yield` and `return` is that `return` will directly jump out of the current loop or method, while `yield` will only jump out of the current `Switch` block. At the same time, when using `yield`, a `default` condition is required

```java
 private static String descLanguage(String name) {
        return switch (name) {
            case "Java": yield "object-oriented, platform independent and secured";
            case "Ruby": yield "a programmer's best friend";
            default: yield name +" is a good language";
        };
 }
```

## Supplement

### About preview features

First post the original text from Oracle's official website: `This is a preview feature, which is a feature whose design, specification, and implementation are complete, but is not permanent, which means that the feature may exist in a different form or not at all in future JDK releases. To compile and run code that contains preview features, you must specify additional command-line options.`

This is a preview feature and the design, specifications, and implementation of the feature are complete, but not permanent, which means the feature may exist in other forms or not exist at all in future JDK versions. To compile and run code that includes preview functionality, additional command line options must be specified.

Take the enhancement of `switch` as an example. It was launched in Java12 and will continue to be enhanced in Java13. It will not be officially entered into the JDK until Java14. You can use it with confidence without considering changes or modifications in subsequent JDK versions.

On the one hand, it can be seen that JDK, as a standard platform, is rigorous in adding new features. On the other hand, I personally think that preview features should be used with caution. Features are easy to design and implement, but their actual value still needs to be verified in use.

### JVM virtual machine optimization

Each release of Java version is accompanied by optimization of the JVM virtual machine, including improvements to existing garbage collection algorithms, introduction of new garbage collection algorithms, removal of old garbage collection algorithms that are no longer suitable for today, etc.

The overall optimization direction is **efficient and low-latency garbage collection performance**

Daily application developers may pay more attention to new syntax features, but from a company's perspective, what is more important to consider when considering whether to upgrade the Java platform is **JVM runtime improvements**

## Reference

- JDK Project Overview: <https://openjdk.java.net/projects/jdk/>
- Oracle Java12 ReleaseNote: <https://www.oracle.com/java/technologies/javase/12all-relnotes.htm>
- What is new in Java 12ï¼š<https://mkyong.com/java/what-is-new-in-java-12/>
- Oracle Java13 ReleaseNote <https://www.oracle.com/technetwork/java/javase/13all-relnotes-5461743.html#NewFeature>
- New Java13 Features <https://www.baeldung.com/java-13-new-features>
- Overview of new features of Java13 <https://www.ibm.com/developerworks/cn/java/the-new-features-of-Java-13/index.html>

<!-- @include: @article-footer.snippet.md -->