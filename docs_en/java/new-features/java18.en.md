---
title: Overview of new features in Java 18
category: Java
tag:
  - Java new features
head:
  - - meta
    - name: keywords
      content: Java 18, JDK18, preview features, API updates, JEP
  - - meta
    - name: description
      content: Get an overview of JDK 18 updates and preview features, and understand the improvements brought by the new API.
---

Java 18 was officially released on March 22, 2022, and is not a long-term support version.

Java 18 brings 9 new features:

- [JEP 400:UTF-8 by Default (The default character set is UTF-8)](https://openjdk.java.net/jeps/400)
- [JEP 408:Simple Web Server (Simple Web Server)](https://openjdk.java.net/jeps/408)
- [JEP 413:Code Snippets in Java API Documentation (Code Snippets in Java API Documentation)](https://openjdk.java.net/jeps/413)
- [JEP 416:Reimplement Core Reflection with Method Handles (reimplement reflection core using method handles)](https://openjdk.java.net/jeps/416)
- [JEP 417: Vector (Vector) API](https://openjdk.java.net/jeps/417) (third incubation)
- [JEP 418: Internet-Address Resolution (SPI)](https://openjdk.java.net/jeps/418)
- [JEP 419: Foreign Function & Memory API (external function and memory API)](https://openjdk.java.net/jeps/419) (second incubation)
- [JEP 420:Pattern Matching for switch (switch pattern matching)](https://openjdk.java.net/jeps/420) (Second preview)
- [JEP 421:Deprecate Finalization for Removal](https://openjdk.java.net/jeps/421)

There are 14 features included in Java 17, 17 features included in Java 16, 14 features included in Java 15, and 16 features included in Java 14. Compared with previously released versions, Java 18 has many fewer new features.

Here I will only give a detailed introduction to the new features 400, 408, 413, 416, 417, 418, and 419 that I think are more important.

Related reading:

- [OpenJDK Java 18 Documentation](https://openjdk.java.net/projects/jdk/18/)
- [IntelliJ IDEA | Java 18 feature support](https://mp.weixin.qq.com/s/PocFKR9z9u7-YCZHsrA5kQ)

## JEP 400: The default character set is UTF-8

The JDK finally makes UTF-8 the default character set.

In Java 17 and earlier versions, the default character set is determined when the Java virtual machine is running and depends on different operating systems, locale settings, etc., so there are potential risks. For example, if you run a normal Java program that prints text to the console on a Mac, garbled characters will appear on Windows if you do not manually change the character set.

## JEP 408: Simple Web Server

After Java 18, you can use the `jwebserver` command to start a simple static web server.

```bash
$jwebserver
Binding to loopback by default. For all interfaces use "-b 0.0.0.0" or "-b ::".
Serving /cwd and subdirectories on 127.0.0.1 port 8000
URL: http://127.0.0.1:8000/
```

This server does not support CGI and Servlets, only static files.

## JEP 413: Optimizing code snippets in Java API documentation

Before Java 18, if we wanted to introduce code snippets in Javadoc we could use `<pre>{@code ...}</pre>`.

```java
<pre>{@code
    lines of source code
}</pre>
```

`<pre>{@code ...}</pre>` The effect generated by this method is relatively average.

After Java 18, you can do this through the `@snippet` tag.

```java
/**
 * The following code shows how to use {@code Optional.isPresent}:
 * {@snippet:
 * if (v.isPresent()) {
 * System.out.println("v: " + v.get());
 * }
 * }
 */
```

`@snippet` This method produces better results and is more convenient to use.

## JEP 416: Reimplementing reflection core using method handles

Java 18 improves the implementation logic of `java.lang.reflect.Method` and `Constructor` to make them perform better and faster. This change will not change the relevant API, which means that you can experience better performance of reflection without changing the reflection-related code during development.

OpenJDK officially provides the reflection performance benchmark results of the new and old implementations.

![Reflection performance benchmark results of new and old implementations](https://oss.javaguide.cn/github/javaguide/java/new-features/JEP416Benchmark.png)

## JEP 417: Vector API (Third Incubation)

The Vector API was originally proposed by [JEP 338](https://openjdk.java.net/jeps/338) and integrated into Java 16 as an [Incubation API](http://openjdk.java.net/jeps/11). The second round of incubation was proposed by [JEP 414](https://openjdk.java.net/jeps/414) and integrated into Java 17, the third round of incubation was proposed by [JEP 417](https://openjdk.java.net/jeps/417) and integrated into Java 18, and the fourth round was proposed by [JEP 426](https://openjdk.java.net/jeps/426) Proposed and integrated into Java 19.

Vector calculations consist of a series of operations on vectors. The Vector API is used to express vector computations that can be reliably compiled at runtime into the best vector instructions on a supported CPU architecture, resulting in performance superior to equivalent scalar computations.

The goal of the Vector API is to provide users with a concise, easy-to-use, platform-independent way of expressing a wide range of vector computations.

This is a simple scalar calculation on array elements:

```java
void scalarComputation(float[] a, float[] b, float[] c) {
   for (int i = 0; i < a.length; i++) {
        c[i] = (a[i] * a[i] + b[i] * b[i]) * -1.0f;
   }
}
```

Here is the equivalent vector calculation using the Vector API:

```java
static final VectorSpecies<Float> SPECIES = FloatVector.SPECIES_PREFERRED;

void vectorComputation(float[] a, float[] b, float[] c) {
    int i = 0;
    int upperBound = SPECIES.loopBound(a.length);
    for (; i < upperBound; i += SPECIES.length()) {
        // FloatVector va, vb, vc;
        var va = FloatVector.fromArray(SPECIES, a, i);
        var vb = FloatVector.fromArray(SPECIES, b, i);
        var vc = va.mul(va)
                   .add(vb.mul(vb))
                   .neg();
        vc.intoArray(c, i);
    }
    for (; i < a.length; i++) {
        c[i] = (a[i] * a[i] + b[i] * b[i]) * -1.0f;
    }
}

```In JDK 18, the performance of the vector API has been further optimized.

## JEP 418: Internet Address Resolution SPI

Java 18 defines a new SPI (service-provider interface) for primary name and address resolution so that `java.net.InetAddress` can use third-party resolvers outside the platform.

## JEP 419: Foreign Function & Memory API (second incubation)

This API allows Java programs to interoperate with code and data outside the Java runtime. By efficiently calling external functions (i.e., code outside the JVM) and safely accessing external memory (i.e., memory not managed by the JVM), the API enables Java programs to call native libraries and manipulate native data without the dangers and brittleness of JNI.

The external functions and memory API had its first incubation in Java 17, proposed by [JEP 412](https://openjdk.java.net/jeps/412). The second incubation was proposed by [JEP 419](https://openjdk.org/jeps/419) and integrated into Java 18, and the preview was proposed by [JEP 424](https://openjdk.org/jeps/424) and integrated into Java 19.

In [Java 19 New Features Overview](./java19.md), I have introduced external functions and memory API in detail, so I will not give additional introduction here.

<!-- @include: @article-footer.snippet.md -->