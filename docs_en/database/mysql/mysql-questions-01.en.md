---
title: MySQLå¸¸è§é¢è¯•é¢˜æ€»ç»“
category: æ•°æ®åº“
tag:
  - MySQL
  - å¤§å‚é¢è¯•
head:
  - - meta
    - name: keywords
      content: MySQLé¢è¯•é¢˜,MySQLåŸºç¡€æ¶æ„,InnoDBå­˜å‚¨å¼•æ“,MySQLç´¢å¼•,B+æ ‘ç´¢å¼•,äº‹åŠ¡éš”ç¦»çº§åˆ«,redo log,undo log,binlog,MVCC,è¡Œçº§é”,æ…¢æŸ¥è¯¢ä¼˜åŒ–
  - - meta
    - name: description
      content: MySQLé«˜é¢‘é¢è¯•é¢˜ç²¾è®²ï¼šåŸºç¡€æ¶æ„ã€InnoDBå¼•æ“ã€ç´¢å¼•åŸç†ã€B+æ ‘ã€äº‹åŠ¡ACIDã€MVCCã€redo/undo/binlogæ—¥å¿—ã€è¡Œé”/è¡¨é”ã€æ…¢æŸ¥è¯¢ä¼˜åŒ–ï¼Œä¸€æ–‡é€Ÿé€šå¤§å‚å¿…è€ƒç‚¹ï¼
---

<!-- @include: @small-advertisement.snippet.md -->

## MySQL åŸºç¡€

### ä»€ä¹ˆæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Ÿ

é¡¾åæ€ä¹‰ï¼Œå…³ç³»å‹æ•°æ®åº“ï¼ˆRDBï¼ŒRelational Databaseï¼‰å°±æ˜¯ä¸€ç§å»ºç«‹åœ¨å…³ç³»æ¨¡å‹çš„åŸºç¡€ä¸Šçš„æ•°æ®åº“ã€‚å…³ç³»æ¨¡å‹è¡¨æ˜äº†æ•°æ®åº“ä¸­æ‰€å­˜å‚¨çš„æ•°æ®ä¹‹é—´çš„è”ç³»ï¼ˆä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šï¼‰ã€‚

å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬çš„æ•°æ®éƒ½è¢«å­˜æ”¾åœ¨äº†å„ç§è¡¨ä¸­ï¼ˆæ¯”å¦‚ç”¨æˆ·è¡¨ï¼‰ï¼Œè¡¨ä¸­çš„æ¯ä¸€è¡Œå°±å­˜æ”¾ç€ä¸€æ¡æ•°æ®ï¼ˆæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼‰ã€‚

![å…³ç³»å‹æ•°æ®åº“è¡¨å…³ç³»](https://oss.javaguide.cn/java-guide-blog/5e3c1a71724a38245aa43b02_99bf70d46cc247be878de9d3a88f0c44.png)

å¤§éƒ¨åˆ†å…³ç³»å‹æ•°æ®åº“éƒ½ä½¿ç”¨ SQL æ¥æ“ä½œæ•°æ®åº“ä¸­çš„æ•°æ®ã€‚å¹¶ä¸”ï¼Œå¤§éƒ¨åˆ†å…³ç³»å‹æ•°æ®åº“éƒ½æ”¯æŒäº‹åŠ¡çš„å››å¤§ç‰¹æ€§(ACID)ã€‚

**æœ‰å“ªäº›å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“å‘¢ï¼Ÿ**

MySQLã€PostgreSQLã€Oracleã€SQL Serverã€SQLiteï¼ˆå¾®ä¿¡æœ¬åœ°çš„èŠå¤©è®°å½•çš„å­˜å‚¨å°±æ˜¯ç”¨çš„ SQLiteï¼‰ â€¦â€¦ã€‚

### ä»€ä¹ˆæ˜¯ SQLï¼Ÿ

SQL æ˜¯ä¸€ç§ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€(Structured Query Language)ï¼Œä¸“é—¨ç”¨æ¥ä¸æ•°æ®åº“æ‰“äº¤é“ï¼Œç›®çš„æ˜¯æä¾›ä¸€ç§ä»æ•°æ®åº“ä¸­è¯»å†™æ•°æ®çš„ç®€å•æœ‰æ•ˆçš„æ–¹æ³•ã€‚

å‡ ä¹æ‰€æœ‰çš„ä¸»æµå…³ç³»æ•°æ®åº“éƒ½æ”¯æŒ SQL ï¼Œé€‚ç”¨æ€§éå¸¸å¼ºã€‚å¹¶ä¸”ï¼Œä¸€äº›éå…³ç³»å‹æ•°æ®åº“ä¹Ÿå…¼å®¹ SQL æˆ–è€…ä½¿ç”¨çš„æ˜¯ç±»ä¼¼äº SQL çš„æŸ¥è¯¢è¯­è¨€ã€‚

SQL å¯ä»¥å¸®åŠ©æˆ‘ä»¬ï¼š

- æ–°å»ºæ•°æ®åº“ã€æ•°æ®è¡¨ã€å­—æ®µï¼›
- åœ¨æ•°æ®åº“ä¸­å¢åŠ ï¼Œåˆ é™¤ï¼Œä¿®æ”¹ï¼ŒæŸ¥è¯¢æ•°æ®ï¼›
- æ–°å»ºè§†å›¾ã€å‡½æ•°ã€å­˜å‚¨è¿‡ç¨‹ï¼›
- å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œç®€å•çš„æ•°æ®åˆ†æï¼›
- æ­é… Hiveï¼ŒSpark SQL åšå¤§æ•°æ®ï¼›
- æ­é… SQLFlow åšæœºå™¨å­¦ä¹ ï¼›
- â€¦â€¦

### ä»€ä¹ˆæ˜¯ MySQLï¼Ÿ

![](https://oss.javaguide.cn/github/javaguide/csdn/20210327143351823.png)

**MySQL æ˜¯ä¸€ç§å…³ç³»å‹æ•°æ®åº“ï¼Œä¸»è¦ç”¨äºæŒä¹…åŒ–å­˜å‚¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­çš„ä¸€äº›æ•°æ®æ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€‚**

ç”±äº MySQL æ˜¯å¼€æºå…è´¹å¹¶ä¸”æ¯”è¾ƒæˆç†Ÿçš„æ•°æ®åº“ï¼Œå› æ­¤ï¼ŒMySQL è¢«å¤§é‡ä½¿ç”¨åœ¨å„ç§ç³»ç»Ÿä¸­ã€‚ä»»ä½•äººéƒ½å¯ä»¥åœ¨ GPL(General Public License) çš„è®¸å¯ä¸‹ä¸‹è½½å¹¶æ ¹æ®ä¸ªæ€§åŒ–çš„éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚MySQL çš„é»˜è®¤ç«¯å£å·æ˜¯**3306**ã€‚

### â­ï¸MySQL æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ

è¿™ä¸ªé—®é¢˜æœ¬è´¨ä¸Šæ˜¯åœ¨é—® MySQL å¦‚æ­¤æµè¡Œçš„åŸå› ã€‚

MySQL æˆåŠŸå¯ä»¥å½’åŠŸäºåœ¨**ç”Ÿæ€ã€åŠŸèƒ½å’Œè¿ç»´**è¿™ä¸‰ä¸ªå±‚é¢ä¸Šçš„ç»¼åˆä¼˜åŠ¿ã€‚

**ç¬¬ä¸€ï¼Œä»ç”Ÿæ€å’Œæˆæœ¬è§’åº¦çœ‹ï¼Œå®ƒçš„æŠ¤åŸæ²³éå¸¸æ·±ã€‚**

- **å¼€æºå…è´¹ï¼š** è¿™æ˜¯å®ƒå¾—ä»¥å¹¿æ³›æ™®åŠçš„åŸºçŸ³ã€‚ä»»ä½•å…¬å¸å’Œä¸ªäººéƒ½å¯ä»¥å…è´¹ä½¿ç”¨ï¼Œæå¤§åœ°é™ä½äº†æŠ€æœ¯é—¨æ§›å’ŒåˆæœŸæˆæœ¬ã€‚
- **ç¤¾åŒºåºå¤§ï¼Œç”Ÿæ€å®Œå–„ï¼š** ç»è¿‡å‡ åå¹´çš„å‘å±•ï¼ŒMySQL æ‹¥æœ‰æå…¶æ´»è·ƒçš„ç¤¾åŒºå’Œä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿã€‚è¿™æ„å‘³ç€æ— è®ºä½ é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œå‡ ä¹éƒ½èƒ½åœ¨ç½‘ä¸Šæ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼›åŒæ—¶ï¼Œå¸‚é¢ä¸Šæ‰€æœ‰çš„ä¸»æµç¼–ç¨‹è¯­è¨€ã€æ¡†æ¶ã€ORM å·¥å…·ã€ç›‘æ§ç³»ç»Ÿéƒ½å¯¹ MySQL æœ‰å®Œç¾çš„æ”¯æŒã€‚å®ƒçš„æ–‡æ¡£ä¹Ÿéå¸¸ä¸°å¯Œï¼Œå­¦ä¹ èµ„æºå”¾æ‰‹å¯å¾—ã€‚

**ç¬¬äºŒï¼Œä»æ ¸å¿ƒæŠ€æœ¯åŠŸèƒ½ä¸Šçœ‹ï¼Œå®ƒéå¸¸å¼ºå¤§ä¸”å‡è¡¡ã€‚**

- **å¼ºå¤§çš„äº‹åŠ¡æ”¯æŒï¼š** è¿™æ˜¯å®ƒä½œä¸ºå…³ç³»å‹æ•°æ®åº“çš„ç«‹èº«ä¹‹æœ¬ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒInnoDB é»˜è®¤çš„å¯é‡å¤è¯»ï¼ˆREPEATABLE-READï¼‰éš”ç¦»çº§åˆ«ï¼Œé€šè¿‡ MVCC å’Œ Next-Key Lock æœºåˆ¶ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»é—®é¢˜ï¼Œè¿™åœ¨å¾ˆå¤šå…¶ä»–æ•°æ®åº“ä¸­éƒ½éœ€è¦æ›´é«˜çš„éš”ç¦»çº§åˆ«æ‰èƒ½åšåˆ°ï¼Œå…¼é¡¾äº†æ€§èƒ½å’Œä¸€è‡´æ€§ã€‚è¯¦ç»†ä»‹ç»å¯ä»¥é˜…è¯»ç¬”è€…å†™çš„è¿™ç¯‡æ–‡ç« ï¼š[MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£](https://javaguide.cn/database/mysql/transaction-isolation-level.html)ã€‚
- **ä¼˜ç§€çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼š** MySQL æœ¬èº«ç»è¿‡äº†æµ·é‡äº’è”ç½‘ä¸šåŠ¡çš„ä¸¥é…·è€ƒéªŒï¼Œå•æœºæ€§èƒ½éå¸¸å‡ºè‰²ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå›´ç»•ç€æ°´å¹³æ‰©å±•ï¼Œå½¢æˆäº†ä¸€å¥—éå¸¸æˆç†Ÿçš„æ¶æ„æ–¹æ¡ˆï¼Œæ¯”å¦‚ä¸»ä»å¤åˆ¶ã€è¯»å†™åˆ†ç¦»ã€ä»¥åŠé€šè¿‡ä¸­é—´ä»¶å®ç°çš„åˆ†åº“åˆ†è¡¨ã€‚è¿™è®©å®ƒèƒ½å¤Ÿæ”¯æ’‘ä»åˆåˆ›å…¬å¸åˆ°å¤§å‹äº’è”ç½‘å¹³å°çš„å„ç§è§„æ¨¡çš„ä¸šåŠ¡ã€‚

**ç¬¬ä¸‰ï¼Œä»è¿ç»´å’Œä½¿ç”¨è§’åº¦çœ‹ï¼Œå®ƒéå¸¸â€˜äº²æ°‘â€™ã€‚**

- **å¼€ç®±å³ç”¨ï¼Œä¸Šæ‰‹ç®€å•ï¼š** ç›¸æ¯”äº Oracle ç­‰å¤§å‹å•†ä¸šæ•°æ®åº“ï¼ŒMySQL çš„å®‰è£…ã€é…ç½®å’Œæ—¥å¸¸ä½¿ç”¨éƒ½éå¸¸ç®€å•ç›´è§‚ï¼Œå­¦ä¹ æ›²çº¿å¹³ç¼“ï¼Œå¯¹äºå¼€å‘è€…å’Œåˆçº§ DBA éå¸¸å‹å¥½ã€‚
- **ç»´æŠ¤æˆæœ¬ä½ï¼š** ç”±äºå…¶ç®€å•æ€§å’Œåºå¤§çš„ç¤¾åŒºï¼Œæ‰¾åˆ°ç›¸å…³çš„è¿ç»´äººæ‰å’Œè§£å†³æ–¹æ¡ˆéƒ½ç›¸å¯¹å®¹æ˜“ï¼Œæ•´ä½“çš„ç»´æŠ¤æˆæœ¬ä¹Ÿæ›´ä½ã€‚

å€¼å¾—ä¸€æçš„æ˜¯æœ€è¿‘å‡ å¹´ï¼ŒPostgreSQL çš„åŠ¿å¤´å¾ˆçŒ›ï¼Œç”šè‡³å‹è¿‡äº† MySQLã€‚ç½‘ä¸Šå‡ºç°äº†å¾ˆå¤šæŠ¨å‡»è¯‹æ¯ MySQL çš„æ–‡ç« ï¼Œç¬”è€…è®¤ä¸ºä»»ä½•æ— è„‘æŠ¨å‡»å…¶ä¸­ä¸€æ–¹æˆ–è€…å¹æ§å¦å¤–ä¸€æ–¹çš„è¡Œä¸ºéƒ½æ˜¯ä¸å¯å–çš„ã€‚

ç¬”è€…ä¹Ÿå†™è¿‡ä¸€ç¯‡æ–‡ç« åˆ†äº«å¯¹è¿™ä¸¤ä¸ªå…³ç³»å‹æ•°æ®åº“ä»£è¡¨çš„çœ‹æ³•ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ï¼š[MySQL è¢«å¹²æˆè€äºŒäº†ï¼Ÿ](https://mp.weixin.qq.com/s/APWD-PzTcTqGUuibAw7GGw)ã€‚

## MySQL å­—æ®µç±»å‹

MySQL å­—æ®µç±»å‹å¯ä»¥ç®€å•åˆ†ä¸ºä¸‰å¤§ç±»ï¼š

- **æ•°å€¼ç±»å‹**ï¼šæ•´å‹ï¼ˆTINYINTã€SMALLINTã€MEDIUMINTã€INT å’Œ BIGINTï¼‰ã€æµ®ç‚¹å‹ï¼ˆFLOAT å’Œ DOUBLEï¼‰ã€å®šç‚¹å‹ï¼ˆDECIMALï¼‰
- **å­—ç¬¦ä¸²ç±»å‹**ï¼šCHARã€VARCHARã€TINYTEXTã€TEXTã€MEDIUMTEXTã€LONGTEXTã€TINYBLOBã€BLOBã€MEDIUMBLOB å’Œ LONGBLOB ç­‰ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ CHAR å’Œ VARCHARã€‚
- **æ—¥æœŸæ—¶é—´ç±»å‹**ï¼šYEARã€TIMEã€DATEã€DATETIME å’Œ TIMESTAMP ç­‰ã€‚

ä¸‹é¢è¿™å¼ å›¾ä¸æ˜¯æˆ‘ç”»çš„ï¼Œå¿˜è®°æ˜¯ä»å“ªé‡Œä¿å­˜ä¸‹æ¥çš„äº†ï¼Œæ€»ç»“çš„è¿˜è›®ä¸é”™çš„ã€‚

![MySQL å¸¸è§å­—æ®µç±»å‹æ€»ç»“](https://oss.javaguide.cn/github/javaguide/mysql/summary-of-mysql-field-types.png)

MySQL å­—æ®µç±»å‹æ¯”è¾ƒå¤šï¼Œæˆ‘è¿™é‡Œä¼šæŒ‘é€‰ä¸€äº›æ—¥å¸¸å¼€å‘ä½¿ç”¨å¾ˆé¢‘ç¹ä¸”é¢è¯•å¸¸é—®çš„å­—æ®µç±»å‹ï¼Œä»¥é¢è¯•é—®é¢˜çš„å½¢å¼æ¥è¯¦ç»†ä»‹ç»ã€‚å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œé’ˆå¯¹çš„éƒ½æ˜¯ InnoDB å­˜å‚¨å¼•æ“ã€‚

å¦å¤–ï¼Œæ¨èé˜…è¯»ä¸€ä¸‹ã€Šé«˜æ€§èƒ½ MySQL(ç¬¬ä¸‰ç‰ˆ)ã€‹çš„ç¬¬å››ç« ï¼Œæœ‰è¯¦ç»†ä»‹ç» MySQL å­—æ®µç±»å‹ä¼˜åŒ–ã€‚

### â­ï¸æ•´æ•°ç±»å‹çš„ UNSIGNED å±æ€§æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

MySQL ä¸­çš„æ•´æ•°ç±»å‹å¯ä»¥ä½¿ç”¨å¯é€‰çš„ UNSIGNED å±æ€§æ¥è¡¨ç¤ºä¸å…è®¸è´Ÿå€¼çš„æ— ç¬¦å·æ•´æ•°ã€‚ä½¿ç”¨ UNSIGNED å±æ€§å¯ä»¥å°†æ­£æ•´æ•°çš„ä¸Šé™æé«˜ä¸€å€ï¼Œå› ä¸ºå®ƒä¸éœ€è¦å­˜å‚¨è´Ÿæ•°å€¼ã€‚

ä¾‹å¦‚ï¼Œ TINYINT UNSIGNED ç±»å‹çš„å–å€¼èŒƒå›´æ˜¯ 0 ~ 255ï¼Œè€Œæ™®é€šçš„ TINYINT ç±»å‹çš„å€¼èŒƒå›´æ˜¯ -128 ~ 127ã€‚INT UNSIGNED ç±»å‹çš„å–å€¼èŒƒå›´æ˜¯ 0 ~ 4,294,967,295ï¼Œè€Œæ™®é€šçš„ INT ç±»å‹çš„å€¼èŒƒå›´æ˜¯ -2,147,483,648 ~ 2,147,483,647ã€‚

å¯¹äºä» 0 å¼€å§‹é€’å¢çš„ ID åˆ—ï¼Œä½¿ç”¨ UNSIGNED å±æ€§å¯ä»¥éå¸¸é€‚åˆï¼Œå› ä¸ºä¸å…è®¸è´Ÿå€¼å¹¶ä¸”å¯ä»¥æ‹¥æœ‰æ›´å¤§çš„ä¸Šé™èŒƒå›´ï¼Œæä¾›äº†æ›´å¤šçš„ ID å€¼å¯ç”¨ã€‚

### CHAR å’Œ VARCHAR çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

CHAR å’Œ VARCHAR æ˜¯æœ€å¸¸ç”¨åˆ°çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š**CHAR æ˜¯å®šé•¿å­—ç¬¦ä¸²ï¼ŒVARCHAR æ˜¯å˜é•¿å­—ç¬¦ä¸²ã€‚**

CHAR åœ¨å­˜å‚¨æ—¶ä¼šåœ¨å³è¾¹å¡«å……ç©ºæ ¼ä»¥è¾¾åˆ°æŒ‡å®šçš„é•¿åº¦ï¼Œæ£€ç´¢æ—¶ä¼šå»æ‰ç©ºæ ¼ï¼›VARCHAR åœ¨å­˜å‚¨æ—¶éœ€è¦ä½¿ç”¨ 1 æˆ– 2 ä¸ªé¢å¤–å­—èŠ‚è®°å½•å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ£€ç´¢æ—¶ä¸éœ€è¦å¤„ç†ã€‚

CHAR æ›´é€‚åˆå­˜å‚¨é•¿åº¦è¾ƒçŸ­æˆ–è€…é•¿åº¦éƒ½å·®ä¸å¤šçš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ Bcrypt ç®—æ³•ã€MD5 ç®—æ³•åŠ å¯†åçš„å¯†ç ã€èº«ä»½è¯å·ç ã€‚VARCHAR ç±»å‹é€‚åˆå­˜å‚¨é•¿åº¦ä¸ç¡®å®šæˆ–è€…å·®å¼‚è¾ƒå¤§çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ç”¨æˆ·æ˜µç§°ã€æ–‡ç« æ ‡é¢˜ç­‰ã€‚

CHAR(M) å’Œ VARCHAR(M) çš„ M éƒ½ä»£è¡¨èƒ½å¤Ÿä¿å­˜çš„å­—ç¬¦æ•°çš„æœ€å¤§å€¼ï¼Œæ— è®ºæ˜¯å­—æ¯ã€æ•°å­—è¿˜æ˜¯ä¸­æ–‡ï¼Œæ¯ä¸ªéƒ½åªå ç”¨ä¸€ä¸ªå­—ç¬¦ã€‚

### VARCHAR(100)å’Œ VARCHAR(10)çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

VARCHAR(100)å’Œ VARCHAR(10)éƒ½æ˜¯å˜é•¿ç±»å‹ï¼Œè¡¨ç¤ºèƒ½å­˜å‚¨æœ€å¤š 100 ä¸ªå­—ç¬¦å’Œ 10 ä¸ªå­—ç¬¦ã€‚å› æ­¤ï¼ŒVARCHAR (100) å¯ä»¥æ»¡è¶³æ›´å¤§èŒƒå›´çš„å­—ç¬¦å­˜å‚¨éœ€æ±‚ï¼Œæœ‰æ›´å¥½çš„ä¸šåŠ¡æ‹“å±•æ€§ã€‚è€Œ VARCHAR(10)å­˜å‚¨è¶…è¿‡ 10 ä¸ªå­—ç¬¦æ—¶ï¼Œå°±éœ€è¦ä¿®æ”¹è¡¨ç»“æ„æ‰å¯ä»¥ã€‚

è™½è¯´ VARCHAR(100)å’Œ VARCHAR(10)èƒ½å­˜å‚¨çš„å­—ç¬¦èŒƒå›´ä¸åŒï¼Œä½†äºŒè€…å­˜å‚¨ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œæ‰€å ç”¨ç£ç›˜çš„å­˜å‚¨ç©ºé—´å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººå®¹æ˜“è¯¯è§£çš„ä¸€ç‚¹ã€‚

ä¸è¿‡ï¼ŒVARCHAR(100) ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚è¿™æ˜¯å› ä¸º VARCHAR ç±»å‹åœ¨å†…å­˜ä¸­æ“ä½œæ—¶ï¼Œé€šå¸¸ä¼šåˆ†é…å›ºå®šå¤§å°çš„å†…å­˜å—æ¥ä¿å­˜å€¼ï¼Œå³ä½¿ç”¨å­—ç¬¦ç±»å‹ä¸­å®šä¹‰çš„é•¿åº¦ã€‚ä¾‹å¦‚åœ¨è¿›è¡Œæ’åºçš„æ—¶å€™ï¼ŒVARCHAR(100)æ˜¯æŒ‰ç…§ 100 è¿™ä¸ªé•¿åº¦æ¥è¿›è¡Œçš„ï¼Œä¹Ÿå°±ä¼šæ¶ˆè€—æ›´å¤šå†…å­˜ã€‚

### DECIMAL å’Œ FLOAT/DOUBLE çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

DECIMAL å’Œ FLOAT çš„åŒºåˆ«æ˜¯ï¼š**DECIMAL æ˜¯å®šç‚¹æ•°ï¼ŒFLOAT/DOUBLE æ˜¯æµ®ç‚¹æ•°ã€‚DECIMAL å¯ä»¥å­˜å‚¨ç²¾ç¡®çš„å°æ•°å€¼ï¼ŒFLOAT/DOUBLE åªèƒ½å­˜å‚¨è¿‘ä¼¼çš„å°æ•°å€¼ã€‚**

DECIMAL ç”¨äºå­˜å‚¨å…·æœ‰ç²¾åº¦è¦æ±‚çš„å°æ•°ï¼Œä¾‹å¦‚ä¸è´§å¸ç›¸å…³çš„æ•°æ®ï¼Œå¯ä»¥é¿å…æµ®ç‚¹æ•°å¸¦æ¥çš„ç²¾åº¦æŸå¤±ã€‚

åœ¨ Java ä¸­ï¼ŒMySQL çš„ DECIMAL ç±»å‹å¯¹åº”çš„æ˜¯ Java ç±» `java.math.BigDecimal`ã€‚

### ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨ TEXT å’Œ BLOBï¼Ÿ

TEXT ç±»å‹ç±»ä¼¼äº CHARï¼ˆ0-255 å­—èŠ‚ï¼‰å’Œ VARCHARï¼ˆ0-65,535 å­—èŠ‚ï¼‰ï¼Œä½†å¯ä»¥å­˜å‚¨æ›´é•¿çš„å­—ç¬¦ä¸²ï¼Œå³é•¿æ–‡æœ¬æ•°æ®ï¼Œä¾‹å¦‚åšå®¢å†…å®¹ã€‚

| ç±»å‹       | å¯å­˜å‚¨å¤§å°           | ç”¨é€”           |
| ---------- | -------------------- | -------------- |
| TINYTEXT   | 0-255 å­—èŠ‚           | ä¸€èˆ¬æ–‡æœ¬å­—ç¬¦ä¸² |
| TEXT       | 0-65,535 å­—èŠ‚        | é•¿æ–‡æœ¬å­—ç¬¦ä¸²   |
| MEDIUMTEXT | 0-16,772,150 å­—èŠ‚    | è¾ƒå¤§æ–‡æœ¬æ•°æ®   |
| LONGTEXT   | 0-4,294,967,295 å­—èŠ‚ | æå¤§æ–‡æœ¬æ•°æ®   |

BLOB ç±»å‹ä¸»è¦ç”¨äºå­˜å‚¨äºŒè¿›åˆ¶å¤§å¯¹è±¡ï¼Œä¾‹å¦‚å›¾ç‰‡ã€éŸ³è§†é¢‘ç­‰æ–‡ä»¶ã€‚

| ç±»å‹       | å¯å­˜å‚¨å¤§å° | ç”¨é€”                     |
| ---------- | ---------- | ------------------------ |
| TINYBLOB   | 0-255 å­—èŠ‚ | çŸ­æ–‡æœ¬äºŒè¿›åˆ¶å­—ç¬¦ä¸²       |
| BLOB       | 0-65KB     | äºŒè¿›åˆ¶å­—ç¬¦ä¸²             |
| MEDIUMBLOB | 0-16MB     | äºŒè¿›åˆ¶å½¢å¼çš„é•¿æ–‡æœ¬æ•°æ®   |
| LONGBLOB   | 0-4GB      | äºŒè¿›åˆ¶å½¢å¼çš„æå¤§æ–‡æœ¬æ•°æ® |

åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¾ˆå°‘ä½¿ç”¨ TEXT ç±»å‹ï¼Œä½†å¶å°”ä¼šç”¨åˆ°ï¼Œè€Œ BLOB ç±»å‹åˆ™åŸºæœ¬ä¸å¸¸ç”¨ã€‚å¦‚æœé¢„æœŸé•¿åº¦èŒƒå›´å¯ä»¥é€šè¿‡ VARCHAR æ¥æ»¡è¶³ï¼Œå»ºè®®é¿å…ä½¿ç”¨ TEXTã€‚

æ•°æ®åº“è§„èŒƒé€šå¸¸ä¸æ¨èä½¿ç”¨ BLOB å’Œ TEXT ç±»å‹ï¼Œè¿™ä¸¤ç§ç±»å‹å…·æœ‰ä¸€äº›ç¼ºç‚¹å’Œé™åˆ¶ï¼Œä¾‹å¦‚ï¼š

- ä¸èƒ½æœ‰é»˜è®¤å€¼ã€‚
- åœ¨ä½¿ç”¨ä¸´æ—¶è¡¨æ—¶æ— æ³•ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œåªèƒ½åœ¨ç£ç›˜ä¸Šåˆ›å»ºä¸´æ—¶è¡¨ï¼ˆã€Šé«˜æ€§èƒ½ MySQLã€‹ä¹¦ä¸­æœ‰æåˆ°ï¼‰ã€‚
- æ£€ç´¢æ•ˆç‡è¾ƒä½ã€‚
- ä¸èƒ½ç›´æ¥åˆ›å»ºç´¢å¼•ï¼Œéœ€è¦æŒ‡å®šå‰ç¼€é•¿åº¦ã€‚
- å¯èƒ½ä¼šæ¶ˆè€—å¤§é‡çš„ç½‘ç»œå’Œ IO å¸¦å®½ã€‚
- å¯èƒ½å¯¼è‡´è¡¨ä¸Šçš„ DML æ“ä½œå˜æ…¢ã€‚
- â€¦â€¦

### â­ï¸DATETIME å’Œ TIMESTAMP çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é€‰æ‹©ï¼Ÿ

DATETIME ç±»å‹æ²¡æœ‰æ—¶åŒºä¿¡æ¯ï¼ŒTIMESTAMP å’Œæ—¶åŒºæœ‰å…³ã€‚

TIMESTAMP åªéœ€è¦ä½¿ç”¨ 4 ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œä½†æ˜¯ DATETIME éœ€è¦è€—è´¹ 8 ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åŒæ ·é€ æˆäº†ä¸€ä¸ªé—®é¢˜ï¼ŒTimestamp è¡¨ç¤ºçš„æ—¶é—´èŒƒå›´æ›´å°ã€‚

- DATETIMEï¼š'1000-01-01 00:00:00.000000' åˆ° '9999-12-31 23:59:59.999999'
- Timestampï¼š'1970-01-01 00:00:01.000000' UTC åˆ° '2038-01-19 03:14:07.999999' UTC

`TIMESTAMP` çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºå…¶å†…å»ºçš„æ—¶åŒºå¤„ç†èƒ½åŠ›ã€‚æ•°æ®åº“è´Ÿè´£ UTC å­˜å‚¨å’ŒåŸºäºä¼šè¯æ—¶åŒºçš„è‡ªåŠ¨è½¬æ¢ï¼Œç®€åŒ–äº†éœ€è¦å¤„ç†å¤šæ—¶åŒºåº”ç”¨çš„å¼€å‘ã€‚å¦‚æœåº”ç”¨éœ€è¦å¤„ç†å¤šæ—¶åŒºï¼Œæˆ–è€…å¸Œæœ›æ•°æ®åº“èƒ½è‡ªåŠ¨ç®¡ç†æ—¶åŒºè½¬æ¢ï¼Œ`TIMESTAMP` æ˜¯è‡ªç„¶çš„é€‰æ‹©ï¼ˆæ³¨æ„å…¶æ—¶é—´èŒƒå›´é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯ 2038 å¹´é—®é¢˜ï¼‰ã€‚

å¦‚æœåº”ç”¨åœºæ™¯ä¸æ¶‰åŠæ—¶åŒºè½¬æ¢ï¼Œæˆ–è€…å¸Œæœ›åº”ç”¨ç¨‹åºå®Œå…¨æ§åˆ¶æ—¶åŒºé€»è¾‘ï¼Œå¹¶ä¸”éœ€è¦è¡¨ç¤º 2038 å¹´ä¹‹åçš„æ—¶é—´ï¼Œ`DATETIME` æ˜¯æ›´ç¨³å¦¥çš„é€‰æ‹©ã€‚

å…³äºä¸¤è€…çš„è¯¦ç»†å¯¹æ¯”ä»¥åŠæ—¥æœŸå­˜å‚¨ç±»å‹é€‰æ‹©å»ºè®®ï¼Œè¯·å‚è€ƒæˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š [MySQL æ—¶é—´ç±»å‹æ•°æ®å­˜å‚¨å»ºè®®](./some-thoughts-on-database-storage-time.md)ã€‚

### NULL å’Œ '' çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

`NULL` å’Œ `''` (ç©ºå­—ç¬¦ä¸²) æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„å€¼ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºä¸åŒçš„å«ä¹‰ï¼Œå¹¶åœ¨æ•°æ®åº“ä¸­æœ‰ç€ä¸åŒçš„è¡Œä¸ºã€‚`NULL` ä»£è¡¨ç¼ºå¤±æˆ–æœªçŸ¥çš„æ•°æ®ï¼Œè€Œ `''` è¡¨ç¤ºä¸€ä¸ªå·²çŸ¥å­˜åœ¨çš„ç©ºå­—ç¬¦ä¸²ã€‚å®ƒä»¬çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š

1. **å«ä¹‰**:
   - `NULL` ä»£è¡¨ä¸€ä¸ªä¸ç¡®å®šçš„å€¼ï¼Œå®ƒä¸ç­‰äºä»»ä½•å€¼ï¼ŒåŒ…æ‹¬å®ƒè‡ªèº«ã€‚å› æ­¤ï¼Œ`SELECT NULL = NULL` çš„ç»“æœæ˜¯ `NULL`ï¼Œè€Œä¸æ˜¯ `true` æˆ– `false`ã€‚ `NULL` æ„å‘³ç€ç¼ºå¤±æˆ–æœªçŸ¥çš„ä¿¡æ¯ã€‚è™½ç„¶ `NULL` ä¸ç­‰äºä»»ä½•å€¼ï¼Œä½†åœ¨æŸäº›æ“ä½œä¸­ï¼Œæ•°æ®åº“ç³»ç»Ÿä¼šå°† `NULL` å€¼è§†ä¸ºç›¸åŒçš„ç±»åˆ«è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚ï¼š`DISTINCT`,`GROUP BY`,`ORDER BY`ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æ“ä½œå°† `NULL` å€¼è§†ä¸ºç›¸åŒçš„ç±»åˆ«è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸æ„å‘³ç€ `NULL` å€¼ä¹‹é—´æ˜¯ç›¸ç­‰çš„ã€‚ å®ƒä»¬åªæ˜¯åœ¨ç‰¹å®šæ“ä½œä¸­è¢«ç‰¹æ®Šå¤„ç†ï¼Œä»¥ä¿è¯ç»“æœçš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚ è¿™ç§å¤„ç†æ–¹å¼æ˜¯ä¸ºäº†æ–¹ä¾¿æ•°æ®æ“ä½œï¼Œè€Œä¸æ˜¯æ”¹å˜äº† `NULL` çš„è¯­ä¹‰ã€‚
   - `''` è¡¨ç¤ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œå®ƒæ˜¯ä¸€ä¸ªå·²çŸ¥çš„å€¼ã€‚
2. **å­˜å‚¨ç©ºé—´**:
   - `NULL` çš„å­˜å‚¨ç©ºé—´å ç”¨å–å†³äºæ•°æ®åº“çš„å®ç°ï¼Œé€šå¸¸éœ€è¦ä¸€äº›ç©ºé—´æ¥æ ‡è®°è¯¥å€¼ä¸ºç©ºã€‚
   - `''` çš„å­˜å‚¨ç©ºé—´å ç”¨é€šå¸¸è¾ƒå°ï¼Œå› ä¸ºå®ƒåªå­˜å‚¨ä¸€ä¸ªç©ºå­—ç¬¦ä¸²çš„æ ‡å¿—ï¼Œä¸éœ€è¦å­˜å‚¨å®é™…çš„å­—ç¬¦ã€‚
3. **æ¯”è¾ƒè¿ç®—**:
   - ä»»ä½•å€¼ä¸ `NULL` è¿›è¡Œæ¯”è¾ƒï¼ˆä¾‹å¦‚ `=`, `!=`, `>`, `<` ç­‰ï¼‰çš„ç»“æœéƒ½æ˜¯ `NULL`ï¼Œè¡¨ç¤ºç»“æœä¸ç¡®å®šã€‚è¦åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸º `NULL`ï¼Œå¿…é¡»ä½¿ç”¨ `IS NULL` æˆ– `IS NOT NULL`ã€‚
   - `''` å¯ä»¥åƒå…¶ä»–å­—ç¬¦ä¸²ä¸€æ ·è¿›è¡Œæ¯”è¾ƒè¿ç®—ã€‚ä¾‹å¦‚ï¼Œ`'' = ''` çš„ç»“æœæ˜¯ `true`ã€‚
4. **èšåˆå‡½æ•°**:
   - å¤§å¤šæ•°èšåˆå‡½æ•°ï¼ˆä¾‹å¦‚ `SUM`, `AVG`, `MIN`, `MAX`ï¼‰ä¼šå¿½ç•¥ `NULL` å€¼ã€‚
   - `COUNT(*)` ä¼šç»Ÿè®¡æ‰€æœ‰è¡Œæ•°ï¼ŒåŒ…æ‹¬åŒ…å« `NULL` å€¼çš„è¡Œã€‚`COUNT(åˆ—å)` ä¼šç»Ÿè®¡æŒ‡å®šåˆ—ä¸­é `NULL` å€¼çš„è¡Œæ•°ã€‚
   - ç©ºå­—ç¬¦ä¸² `''` ä¼šè¢«èšåˆå‡½æ•°è®¡ç®—åœ¨å†…ã€‚ä¾‹å¦‚ï¼Œ`SUM` ä¼šå°†å…¶è§†ä¸º 0ï¼Œ`MIN` å’Œ `MAX` ä¼šå°†å…¶è§†ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚

çœ‹äº†ä¸Šé¢çš„ä»‹ç»ä¹‹åï¼Œç›¸ä¿¡ä½ å¯¹å¦å¤–ä¸€ä¸ªé«˜é¢‘é¢è¯•é¢˜ï¼šâ€œä¸ºä»€ä¹ˆ MySQL ä¸å»ºè®®ä½¿ç”¨ `NULL` ä½œä¸ºåˆ—é»˜è®¤å€¼ï¼Ÿâ€ä¹Ÿæœ‰äº†ç­”æ¡ˆã€‚

### â­ï¸Boolean ç±»å‹å¦‚ä½•è¡¨ç¤ºï¼Ÿ

MySQL ä¸­æ²¡æœ‰ä¸“é—¨çš„å¸ƒå°”ç±»å‹ï¼Œè€Œæ˜¯ç”¨ `TINYINT(1)` ç±»å‹æ¥è¡¨ç¤ºå¸ƒå°”å€¼ã€‚`TINYINT(1)` ç±»å‹å¯ä»¥å­˜å‚¨ 0 æˆ– 1ï¼Œåˆ†åˆ«å¯¹åº” false æˆ– trueã€‚

### â­ï¸æ‰‹æœºå·å­˜å‚¨ç”¨ INT è¿˜æ˜¯ VARCHARï¼Ÿ

å­˜å‚¨æ‰‹æœºå·ï¼Œ**å¼ºçƒˆæ¨èä½¿ç”¨ VARCHAR ç±»å‹**ï¼Œè€Œä¸æ˜¯ INT æˆ– BIGINTã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š

1. **æ ¼å¼å…¼å®¹æ€§ä¸å®Œæ•´æ€§ï¼š**
   - æ‰‹æœºå·å¯èƒ½åŒ…å«å‰å¯¼é›¶ï¼ˆå¦‚æŸäº›åœ°åŒºçš„å›ºè¯åŒºå·ï¼‰ã€å›½å®¶ä»£ç å‰ç¼€ï¼ˆ'+'ï¼‰ï¼Œç”šè‡³å¯èƒ½å¸¦æœ‰åˆ†éš”ç¬¦ï¼ˆ'-' æˆ–ç©ºæ ¼ï¼‰ã€‚INT æˆ– BIGINT è¿™ç§æ•°å­—ç±»å‹ä¼šè‡ªåŠ¨ä¸¢å¤±è¿™äº›é‡è¦çš„æ ¼å¼ä¿¡æ¯ï¼ˆæ¯”å¦‚å‰å¯¼é›¶ä¼šè¢«å»æ‰ï¼Œ'+' å’Œ '-' æ— æ³•å­˜å‚¨ï¼‰ã€‚
   - VARCHAR å¯ä»¥åŸæ ·å­˜å‚¨å„ç§æ ¼å¼çš„å·ç ï¼Œæ— è®ºæ˜¯å›½å†…çš„ 11 ä½æ‰‹æœºå·ï¼Œè¿˜æ˜¯å¸¦æœ‰å›½å®¶ä»£ç çš„å›½é™…å·ç ï¼Œéƒ½èƒ½å®Œç¾å…¼å®¹ã€‚
2. **éç®—æœ¯æ€§ï¼š**æ‰‹æœºå·è™½ç„¶çœ‹èµ·æ¥æ˜¯æ•°å­—ï¼Œä½†æˆ‘ä»¬ä»ä¸å¯¹å®ƒè¿›è¡Œæ•°å­¦è¿ç®—ï¼ˆæ¯”å¦‚æ±‚å’Œã€å¹³å‡å€¼ï¼‰ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç”¨ VARCHAR æ›´ç¬¦åˆå…¶æ•°æ®æ€§è´¨ã€‚
3. **æŸ¥è¯¢çµæ´»æ€§ï¼š**
   - ä¸šåŠ¡ä¸­å¸¸å¸¸éœ€è¦æ ¹æ®å·æ®µï¼ˆå‰ç¼€ï¼‰è¿›è¡ŒæŸ¥è¯¢ï¼Œä¾‹å¦‚æŸ¥æ‰¾æ‰€æœ‰ "138" å¼€å¤´çš„ç”¨æˆ·ã€‚ä½¿ç”¨ VARCHAR ç±»å‹é…åˆ `LIKE '138%'` è¿™æ ·çš„ SQL æŸ¥è¯¢æ—¢ç›´è§‚åˆé«˜æ•ˆã€‚
   - å¦‚æœä½¿ç”¨æ•°å­—ç±»å‹ï¼Œè¿›è¡Œç±»ä¼¼çš„å‰ç¼€åŒ¹é…é€šå¸¸éœ€è¦å¤æ‚çš„å‡½æ•°è½¬æ¢ï¼ˆå¦‚ CAST æˆ– SUBSTRINGï¼‰ï¼Œæˆ–è€…ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ `WHERE phone >= 13800000000 AND phone < 13900000000`ï¼‰ï¼Œè¿™ä¸ä»…å†™æ³•ç¹çï¼Œè€Œä¸”å¯èƒ½æ— æ³•æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚
4. **åŠ å¯†å­˜å‚¨çš„è¦æ±‚ï¼ˆéå¸¸å…³é”®ï¼‰ï¼š**
   - å‡ºäºæ•°æ®å®‰å…¨å’Œéšç§åˆè§„çš„è¦æ±‚ï¼Œæ‰‹æœºå·è¿™ç±»æ•æ„Ÿä¸ªäººä¿¡æ¯é€šå¸¸å¿…é¡»åŠ å¯†å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚
- The encrypted data (ciphertext) is a long string of characters (usually composed of letters, numbers, symbols, or Base64/Hex encoded), and the INT or BIGINT types cannot store this ciphertext at all. Only types such as VARCHAR, TEXT, or BLOB will do.

**About VARCHAR length selection:**

- **If stored without encryption (strongly not recommended!):** Considering international numbers and possible format characters, VARCHAR(20) to VARCHAR(32) is usually a relatively safe range, enough to cover the vast majority of mobile phone number formats around the world. VARCHAR(15) may not be sufficient for some numbers with country codes and formatting characters.
- **If storing encrypted (recommended standard practice):** The length must be accurately calculated and set based on the maximum length of the ciphertext produced by the chosen encryption algorithm, and possible encoding methods (e.g. Base64 will increase the length by about 1/3). Often longer VARCHAR lengths are required, such as VARCHAR(128), VARCHAR(256) or even longer.

Finally, here is a table to summarize:

| Comparing dimensions | VARCHAR type (recommended) | INT/BIGINT type (not recommended) | Description/Remarks |
|---------------- | ---------------------------------- | ---------------------------------- | ------------------------------------------------------------------------------- |
| **Format Compatibility** | âœ” Can store leading zeros, "+", "-", spaces, etc. | âœ˜ Leading zeros are automatically lost and symbols cannot be stored | VARCHAR can store various mobile phone number formats as they are, INT/BIGINT only supports simple numbers, and leading zeros will disappear |
| **Integrity** | âœ” No format information is lost | âœ˜ Format information is lost | For example, "013800012345" stored in INT will become 13800012345, and "+" cannot be stored |
| **Non-arithmetic** | âœ” Suitable for storing "identifiers" | âœ˜ Only suitable for numerical operations | Mobile phone numbers are essentially string identifiers and do not perform mathematical operations. VARCHAR is more suitable for practical purposes |
| **Query flexibility** | âœ” Supports `LIKE '138%'`, etc. | âœ˜ Querying prefixes is inconvenient or has poor performance | Use VARCHAR to efficiently query by number segment/prefix, but the numeric type needs to be converted to a string or other complex processing |
| **Encrypted storage support** | âœ” Can store encrypted ciphertext (letters, symbols, etc.) | âœ˜ Unable to store ciphertext | After encrypting the mobile phone number, the ciphertext is a string/binary, only VARCHAR, TEXT, BLOB, etc. are compatible |
| **Length setting recommendations** | 15~20 (unencrypted), encryption depends on the situation | Meaningless | When not encrypted, VARCHAR(15~20) is universal, the encrypted length depends on the algorithm and encoding method |

## MySQL Infrastructure

> It is recommended to read this article [Execution Process of SQL Statements in MySQL](./how-sql-executed-in-mysql.md) to understand the MySQL infrastructure. In addition, "the execution flow of a SQL statement in MySQL" is also a frequently asked question in interviews.

The following figure is a brief architecture diagram of MySQL. From the figure below, you can clearly see how a SQL statement on the client is executed inside MySQL.

![](https://oss.javaguide.cn/javaguide/13526879-3037b144ed09eb88.png)

As can be seen from the above figure, MySQL mainly consists of the following parts:

- **Connector:** Identity authentication and permission related (when logging in to MySQL).
- **Query cache:** When executing a query statement, the cache will be queried first (removed after MySQL 8.0 version, because this function is not very practical).
- **Analyzer:** If the cache is not hit, the SQL statement will go through the analyzer. To put it bluntly, the analyzer needs to first see what your SQL statement is doing, and then check whether the syntax of your SQL statement is correct.
- **Optimizer:** Execute according to the solution considered optimal by MySQL.
- **Executor:** Execute the statement and return data from the storage engine. Before executing the statement, it will be judged whether there is permission. If there is no permission, an error will be reported.
- **Plug-in storage engine**: Mainly responsible for data storage and reading. It adopts a plug-in architecture and supports various storage engines such as InnoDB, MyISAM, and Memory. InnoDB is the default storage engine of MySQL. In most scenarios, using InnoDB is the best choice.

## MySQL storage engine

The core of MySQL lies in the storage engine. If you want to learn MySQL in depth, you must study the MySQL storage engine in depth.

### What storage engines does MySQL support? Which one is used by default?

MySQL supports multiple storage engines. You can view all storage engines supported by MySQL through the `SHOW ENGINES` command.

![View all storage engines provided by MySQL](https://oss.javaguide.cn/github/javaguide/mysql/image-20220510105408703.png)

From the picture above, we can see that MySQL's current default storage engine is InnoDB. Moreover, among all storage engines, only InnoDB is a transactional storage engine, which means that only InnoDB supports transactions.

The MySQL version I use here is 8.x, and there may be differences between different MySQL versions.

Prior to MySQL 5.5.5, MyISAM was the default storage engine for MySQL. After version 5.5.5, InnoDB is the default storage engine for MySQL.

You can check your MySQL version with the `SELECT VERSION()` command.

```bash
mysql> SELECT VERSION();
+-----------+
| VERSION() |
+-----------+
| 8.0.27 |
+-----------+
1 row in set (0.00 sec)
```

You can also directly view MySQL's current default storage engine through the `SHOW VARIABLES LIKE '%storage_engine%'` command.

```bash
mysql> SHOW VARIABLES LIKE '%storage_engine%';
+----------------------------------+----------+
| Variable_name | Value |
+----------------------------------+----------+
| default_storage_engine | InnoDB |
| default_tmp_storage_engine | InnoDB |
| disabled_storage_engines | |
| internal_tmp_mem_storage_engine | TempTable |
+----------------------------------+----------+
4 rows in set (0.00 sec)
```

If you want to have an in-depth understanding of each storage engine and the differences between them, it is recommended that you read the following introduction in the official MySQL document (the interview will not ask such detailed questions, just understand it):

- Detailed introduction to InnoDB storage engine: <https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html>.
- Detailed introduction to other storage engines: <https://dev.mysql.com/doc/refman/8.0/en/storage-engines.html>.

![](https://oss.javaguide.cn/github/javaguide/mysql/image-20220510155143458.png)

### Do you understand the MySQL storage engine architecture?

The MySQL storage engine adopts a **plug-in architecture** and supports multiple storage engines. We can even set up different storage engines for different database tables to meet the needs of different scenarios. **The storage engine is based on tables, not databases. **

The following diagram shows the MySQL architecture with pluggable storage engines:

![MySQL architecture diagram showing connectors, interfaces, pluggable storage engines, the file system with files and logs.](https://oss.javaguide.cn/github/javaguide/mysql/mysql-architecture.png)ä½ è¿˜å¯ä»¥æ ¹æ® MySQL å®šä¹‰çš„å­˜å‚¨å¼•æ“å®ç°æ ‡å‡†æ¥å£æ¥ç¼–å†™ä¸€ä¸ªå±äºè‡ªå·±çš„å­˜å‚¨å¼•æ“ã€‚è¿™äº›éå®˜æ–¹æä¾›çš„å­˜å‚¨å¼•æ“å¯ä»¥ç§°ä¸ºç¬¬ä¸‰æ–¹å­˜å‚¨å¼•æ“ï¼ŒåŒºåˆ«äºå®˜æ–¹å­˜å‚¨å¼•æ“ã€‚åƒç›®å‰æœ€å¸¸ç”¨çš„ InnoDB å…¶å®åˆšå¼€å§‹å°±æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹å­˜å‚¨å¼•æ“ï¼Œåé¢ç”±äºè¿‡äºä¼˜ç§€ï¼Œå…¶è¢« Oracle ç›´æ¥æ”¶è´­äº†ã€‚

MySQL å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰ä»‹ç»åˆ°å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰å­˜å‚¨å¼•æ“ï¼Œåœ°å€ï¼š<https://dev.mysql.com/doc/internals/en/custom-engine.html> ã€‚

### â­ï¸MyISAM å’Œ InnoDB æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

MySQL 5.5 ä¹‹å‰ï¼ŒMyISAM å¼•æ“æ˜¯ MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œå¯è°“æ˜¯é£å…‰ä¸€æ—¶ã€‚

è™½ç„¶ï¼ŒMyISAM çš„æ€§èƒ½è¿˜è¡Œï¼Œå„ç§ç‰¹æ€§ä¹Ÿè¿˜ä¸é”™ï¼ˆæ¯”å¦‚å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°ç­‰ï¼‰ã€‚ä½†æ˜¯ï¼ŒMyISAM ä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œè€Œä¸”æœ€å¤§çš„ç¼ºé™·å°±æ˜¯å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ã€‚

MySQL 5.5 ç‰ˆæœ¬ä¹‹åï¼ŒInnoDB æ˜¯ MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚

è¨€å½’æ­£ä¼ ï¼å’±ä»¬ä¸‹é¢è¿˜æ˜¯æ¥ç®€å•å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…ï¼š

**1ã€æ˜¯å¦æ”¯æŒè¡Œçº§é”**

MyISAM åªæœ‰è¡¨çº§é”(table-level locking)ï¼Œè€Œ InnoDB æ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”,é»˜è®¤ä¸ºè¡Œçº§é”ã€‚

ä¹Ÿå°±è¯´ï¼ŒMyISAM ä¸€é”å°±æ˜¯é”ä½äº†æ•´å¼ è¡¨ï¼Œè¿™åœ¨å¹¶å‘å†™çš„æƒ…å†µä¸‹æ˜¯å¤šä¹ˆæ»´æ†¨æ†¨å•Šï¼è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ InnoDB åœ¨å¹¶å‘å†™çš„æ—¶å€™ï¼Œæ€§èƒ½æ›´ç‰›çš®äº†ï¼

**2ã€æ˜¯å¦æ”¯æŒäº‹åŠ¡**

MyISAM ä¸æä¾›äº‹åŠ¡æ”¯æŒã€‚

InnoDB æä¾›äº‹åŠ¡æ”¯æŒï¼Œå®ç°äº† SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼Œå…·æœ‰æäº¤(commit)å’Œå›æ»š(rollback)äº‹åŠ¡çš„èƒ½åŠ›ã€‚å¹¶ä¸”ï¼ŒInnoDB é»˜è®¤ä½¿ç”¨çš„ REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰éš”ç¦»çº§åˆ«æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜å‘ç”Ÿçš„ï¼ˆåŸºäº MVCC å’Œ Next-Key Lockï¼‰ã€‚

å…³äº MySQL äº‹åŠ¡çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š[MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£](./transaction-isolation-level.md)ã€‚

**3ã€æ˜¯å¦æ”¯æŒå¤–é”®**

MyISAM ä¸æ”¯æŒï¼Œè€Œ InnoDB æ”¯æŒã€‚

å¤–é”®å¯¹äºç»´æŠ¤æ•°æ®ä¸€è‡´æ€§éå¸¸æœ‰å¸®åŠ©ï¼Œä½†æ˜¯å¯¹æ€§èƒ½æœ‰ä¸€å®šçš„æŸè€—ã€‚å› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä¸å»ºè®®åœ¨å®é™…ç”Ÿäº§é¡¹ç›®ä¸­ä½¿ç”¨å¤–é”®çš„ï¼Œåœ¨ä¸šåŠ¡ä»£ç ä¸­è¿›è¡Œçº¦æŸå³å¯ï¼

é˜¿é‡Œçš„ã€ŠJava å¼€å‘æ‰‹å†Œã€‹ä¹Ÿæ˜¯æ˜ç¡®è§„å®šç¦æ­¢ä½¿ç”¨å¤–é”®çš„ã€‚

![](https://oss.javaguide.cn/github/javaguide/mysql/image-20220510090309427.png)

ä¸è¿‡ï¼Œåœ¨ä»£ç ä¸­è¿›è¡Œçº¦æŸçš„è¯ï¼Œå¯¹ç¨‹åºå‘˜çš„èƒ½åŠ›è¦æ±‚æ›´é«˜ï¼Œå…·ä½“æ˜¯å¦è¦é‡‡ç”¨å¤–é”®è¿˜æ˜¯è¦æ ¹æ®ä½ çš„é¡¹ç›®å®é™…æƒ…å†µè€Œå®šã€‚

æ€»ç»“ï¼šä¸€èˆ¬æˆ‘ä»¬ä¹Ÿæ˜¯ä¸å»ºè®®åœ¨æ•°æ®åº“å±‚é¢ä½¿ç”¨å¤–é”®çš„ï¼Œåº”ç”¨å±‚é¢å¯ä»¥è§£å†³ã€‚ä¸è¿‡ï¼Œè¿™æ ·ä¼šå¯¹æ•°æ®çš„ä¸€è‡´æ€§é€ æˆå¨èƒã€‚å…·ä½“è¦ä¸è¦ä½¿ç”¨å¤–é”®è¿˜æ˜¯è¦æ ¹æ®ä½ çš„é¡¹ç›®æ¥å†³å®šã€‚

**4ã€æ˜¯å¦æ”¯æŒæ•°æ®åº“å¼‚å¸¸å´©æºƒåçš„å®‰å…¨æ¢å¤**

MyISAM ä¸æ”¯æŒï¼Œè€Œ InnoDB æ”¯æŒã€‚

ä½¿ç”¨ InnoDB çš„æ•°æ®åº“åœ¨å¼‚å¸¸å´©æºƒåï¼Œæ•°æ®åº“é‡æ–°å¯åŠ¨çš„æ—¶å€™ä¼šä¿è¯æ•°æ®åº“æ¢å¤åˆ°å´©æºƒå‰çš„çŠ¶æ€ã€‚è¿™ä¸ªæ¢å¤çš„è¿‡ç¨‹ä¾èµ–äº `redo log` ã€‚

**5ã€æ˜¯å¦æ”¯æŒ MVCC**

MyISAM ä¸æ”¯æŒï¼Œè€Œ InnoDB æ”¯æŒã€‚

è®²çœŸï¼Œè¿™ä¸ªå¯¹æ¯”æœ‰ç‚¹åºŸè¯ï¼Œæ¯•ç«Ÿ MyISAM è¿è¡Œçº§é”éƒ½ä¸æ”¯æŒã€‚MVCC å¯ä»¥çœ‹ä½œæ˜¯è¡Œçº§é”çš„ä¸€ä¸ªå‡çº§ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘åŠ é”æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚

**6ã€ç´¢å¼•å®ç°ä¸ä¸€æ ·ã€‚**

è™½ç„¶ MyISAM å¼•æ“å’Œ InnoDB å¼•æ“éƒ½æ˜¯ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä½†æ˜¯ä¸¤è€…çš„å®ç°æ–¹å¼ä¸å¤ªä¸€æ ·ã€‚

InnoDB å¼•æ“ä¸­ï¼Œå…¶æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚ç›¸æ¯” MyISAMï¼Œç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œå…¶è¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰ B+Tree ç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œæ ‘çš„å¶èŠ‚ç‚¹ data åŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚

è¯¦ç»†åŒºåˆ«ï¼Œæ¨èä½ çœ‹çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š[MySQL ç´¢å¼•è¯¦è§£](./mysql-index.md)ã€‚

**7ã€æ€§èƒ½æœ‰å·®åˆ«ã€‚**

InnoDB çš„æ€§èƒ½æ¯” MyISAM æ›´å¼ºå¤§ï¼Œä¸ç®¡æ˜¯åœ¨è¯»å†™æ··åˆæ¨¡å¼ä¸‹è¿˜æ˜¯åªè¯»æ¨¡å¼ä¸‹ï¼Œéšç€ CPU æ ¸æ•°çš„å¢åŠ ï¼ŒInnoDB çš„è¯»å†™èƒ½åŠ›å‘ˆçº¿æ€§å¢é•¿ã€‚MyISAM å› ä¸ºè¯»å†™ä¸èƒ½å¹¶å‘ï¼Œå®ƒçš„å¤„ç†èƒ½åŠ›è·Ÿæ ¸æ•°æ²¡å…³ç³»ã€‚

![InnoDB å’Œ MyISAM æ€§èƒ½å¯¹æ¯”](https://oss.javaguide.cn/github/javaguide/mysql/innodb-myisam-performance-comparison.png)

**8ã€æ•°æ®ç¼“å­˜ç­–ç•¥å’Œæœºåˆ¶å®ç°ä¸åŒã€‚**

InnoDB ä½¿ç”¨ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰ç¼“å­˜æ•°æ®é¡µå’Œç´¢å¼•é¡µï¼ŒMyISAM ä½¿ç”¨é”®ç¼“å­˜ï¼ˆKey Cacheï¼‰ä»…ç¼“å­˜ç´¢å¼•é¡µè€Œä¸ç¼“å­˜æ•°æ®é¡µã€‚

**æ€»ç»“**ï¼š

- InnoDB æ”¯æŒè¡Œçº§åˆ«çš„é”ç²’åº¦ï¼ŒMyISAM ä¸æ”¯æŒï¼Œåªæ”¯æŒè¡¨çº§åˆ«çš„é”ç²’åº¦ã€‚
- MyISAM ä¸æä¾›äº‹åŠ¡æ”¯æŒã€‚InnoDB æä¾›äº‹åŠ¡æ”¯æŒï¼Œå®ç°äº† SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ã€‚
- MyISAM ä¸æ”¯æŒå¤–é”®ï¼Œè€Œ InnoDB æ”¯æŒã€‚
- MyISAM ä¸æ”¯æŒ MVCCï¼Œè€Œ InnoDB æ”¯æŒã€‚
- è™½ç„¶ MyISAM å¼•æ“å’Œ InnoDB å¼•æ“éƒ½æ˜¯ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä½†æ˜¯ä¸¤è€…çš„å®ç°æ–¹å¼ä¸å¤ªä¸€æ ·ã€‚
- MyISAM ä¸æ”¯æŒæ•°æ®åº“å¼‚å¸¸å´©æºƒåçš„å®‰å…¨æ¢å¤ï¼Œè€Œ InnoDB æ”¯æŒã€‚
- InnoDB çš„æ€§èƒ½æ¯” MyISAM æ›´å¼ºå¤§ã€‚

æœ€åï¼Œå†åˆ†äº«ä¸€å¼ å›¾ç‰‡ç»™ä½ ï¼Œè¿™å¼ å›¾ç‰‡è¯¦ç»†å¯¹æ¯”äº†å¸¸è§çš„å‡ ç§ MySQL å­˜å‚¨å¼•æ“ã€‚

![å¸¸è§çš„å‡ ç§ MySQL å­˜å‚¨å¼•æ“å¯¹æ¯”](https://oss.javaguide.cn/github/javaguide/mysql/comparison-of-common-mysql-storage-engines.png)

### MyISAM å’Œ InnoDB å¦‚ä½•é€‰æ‹©ï¼Ÿ

å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯ InnoDB å­˜å‚¨å¼•æ“ï¼Œåœ¨æŸäº›è¯»å¯†é›†çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ MyISAM ä¹Ÿæ˜¯åˆé€‚çš„ã€‚ä¸è¿‡ï¼Œå‰ææ˜¯ä½ çš„é¡¹ç›®ä¸ä»‹æ„ MyISAM ä¸æ”¯æŒäº‹åŠ¡ã€å´©æºƒæ¢å¤ç­‰ç¼ºç‚¹ï¼ˆå¯æ˜¯~æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä»‹æ„å•Šï¼‰ã€‚

ã€ŠMySQL é«˜æ€§èƒ½ã€‹ä¸Šé¢æœ‰ä¸€å¥è¯è¿™æ ·å†™åˆ°:

> ä¸è¦è½»æ˜“ç›¸ä¿¡â€œMyISAM æ¯” InnoDB å¿«â€ä¹‹ç±»çš„ç»éªŒä¹‹è°ˆï¼Œè¿™ä¸ªç»“è®ºå¾€å¾€ä¸æ˜¯ç»å¯¹çš„ã€‚åœ¨å¾ˆå¤šæˆ‘ä»¬å·²çŸ¥åœºæ™¯ä¸­ï¼ŒInnoDB çš„é€Ÿåº¦éƒ½å¯ä»¥è®© MyISAM æœ›å°˜è«åŠï¼Œå°¤å…¶æ˜¯ç”¨åˆ°äº†èšç°‡ç´¢å¼•ï¼Œæˆ–è€…éœ€è¦è®¿é—®çš„æ•°æ®éƒ½å¯ä»¥æ”¾å…¥å†…å­˜çš„åº”ç”¨ã€‚

å› æ­¤ï¼Œå¯¹äºå’±ä»¬æ—¥å¸¸å¼€å‘çš„ä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œä½ å‡ ä¹æ‰¾ä¸åˆ°ä»€ä¹ˆç†ç”±ä½¿ç”¨ MyISAM äº†ï¼Œè€è€å®å®ç”¨é»˜è®¤çš„ InnoDB å°±å¯ä»¥äº†ï¼

## â­ï¸MySQL ç´¢å¼•

MySQL ç´¢å¼•ç›¸å…³çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œä¹Ÿéå¸¸é‡è¦ï¼Œæ›´è¯¦ç»†çš„ä»‹ç»å¯ä»¥é˜…è¯»ç¬”è€…å†™çš„è¿™ç¯‡æ–‡ç« ï¼š[MySQL ç´¢å¼•è¯¦è§£](./mysql-index.md) ã€‚

### ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ

**ç´¢å¼•æ˜¯ä¸€ç§ç”¨äºå¿«é€ŸæŸ¥è¯¢å’Œæ£€ç´¢æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œå…¶æœ¬è´¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§æ’åºå¥½çš„æ•°æ®ç»“æ„ã€‚**

ç´¢å¼•çš„ä½œç”¨å°±ç›¸å½“äºä¹¦çš„ç›®å½•ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼šæˆ‘ä»¬åœ¨æŸ¥å­—å…¸çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç›®å½•ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½ä¸€é¡µä¸€é¡µåœ°å»æ‰¾æˆ‘ä»¬éœ€è¦æŸ¥çš„é‚£ä¸ªå­—ï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼›å¦‚æœæœ‰ç›®å½•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆå»ç›®å½•é‡ŒæŸ¥æ‰¾å­—çš„ä½ç½®ï¼Œç„¶åç›´æ¥ç¿»åˆ°é‚£ä¸€é¡µå°±è¡Œäº†ã€‚

ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„å­˜åœ¨å¾ˆå¤šç§ç±»å‹ï¼Œå¸¸è§çš„ç´¢å¼•ç»“æ„æœ‰ï¼šB æ ‘ã€ B+ æ ‘ å’Œ Hashã€çº¢é»‘æ ‘ã€‚åœ¨ MySQL ä¸­ï¼Œæ— è®ºæ˜¯ Innodb è¿˜æ˜¯ MyISAMï¼Œéƒ½ä½¿ç”¨äº† B+ æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ã€‚

**ç´¢å¼•çš„ä¼˜ç‚¹ï¼š**

1. **æŸ¥è¯¢é€Ÿåº¦èµ·é£ (ä¸»è¦ç›®çš„)**ï¼šé€šè¿‡ç´¢å¼•ï¼Œæ•°æ®åº“å¯ä»¥**å¤§å¹…å‡å°‘éœ€è¦æ‰«æçš„æ•°æ®é‡**ï¼Œç›´æ¥å®šä½åˆ°ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œä»è€Œæ˜¾è‘—åŠ å¿«æ•°æ®æ£€ç´¢é€Ÿåº¦ï¼Œå‡å°‘ç£ç›˜ I/O æ¬¡æ•°ã€‚
2. **ä¿è¯æ•°æ®å”¯ä¸€æ€§**ï¼šé€šè¿‡åˆ›å»º**å”¯ä¸€ç´¢å¼• (Unique Index)**,å¯ä»¥ç¡®ä¿è¡¨ä¸­çš„æŸä¸€åˆ—ï¼ˆæˆ–å‡ åˆ—ç»„åˆï¼‰çš„å€¼æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œæ¯”å¦‚ç”¨æˆ· IDã€é‚®ç®±ç­‰ã€‚ä¸»é”®æœ¬èº«å°±æ˜¯ä¸€ç§å”¯ä¸€ç´¢å¼•ã€‚
3. **åŠ é€Ÿæ’åºå’Œåˆ†ç»„**ï¼šå¦‚æœæŸ¥è¯¢ä¸­çš„ ORDER BY æˆ– GROUP BY å­å¥æ¶‰åŠçš„åˆ—å»ºæœ‰ç´¢å¼•ï¼Œæ•°æ®åº“å¾€å¾€å¯ä»¥ç›´æ¥åˆ©ç”¨ç´¢å¼•å·²ç»æ’å¥½åºçš„ç‰¹æ€§ï¼Œé¿å…é¢å¤–çš„æ’åºæ“ä½œï¼Œä»è€Œæå‡æ€§èƒ½ã€‚

**ç´¢å¼•çš„ç¼ºç‚¹ï¼š**

1. **åˆ›å»ºå’Œç»´æŠ¤è€—æ—¶**ï¼šåˆ›å»ºç´¢å¼•æœ¬èº«éœ€è¦æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å¯¹å¤§è¡¨æ“ä½œæ—¶ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œ**å¢ã€åˆ ã€æ”¹ (DML æ“ä½œ)** æ—¶ï¼Œä¸ä»…è¦æ“ä½œæ•°æ®æœ¬èº«ï¼Œç›¸å…³çš„ç´¢å¼•ä¹Ÿå¿…é¡»åŠ¨æ€æ›´æ–°å’Œç»´æŠ¤ï¼Œè¿™ä¼š**é™ä½è¿™äº› DML æ“ä½œçš„æ‰§è¡Œæ•ˆç‡**ã€‚
2. **å ç”¨å­˜å‚¨ç©ºé—´**ï¼šç´¢å¼•æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œéœ€è¦ä»¥ç‰©ç†æ–‡ä»¶ï¼ˆæˆ–å†…å­˜ç»“æ„ï¼‰çš„å½¢å¼å­˜å‚¨ï¼Œå› æ­¤ä¼š**é¢å¤–å ç”¨ä¸€å®šçš„ç£ç›˜ç©ºé—´**ã€‚ç´¢å¼•è¶Šå¤šã€è¶Šå¤§ï¼Œå ç”¨çš„ç©ºé—´ä¹Ÿå°±è¶Šå¤šã€‚
3. **å¯èƒ½è¢«è¯¯ç”¨æˆ–å¤±æ•ˆ**ï¼šå¦‚æœç´¢å¼•è®¾è®¡ä¸å½“ï¼Œæˆ–è€…æŸ¥è¯¢è¯­å¥å†™å¾—ä¸å¥½ï¼Œæ•°æ®åº“ä¼˜åŒ–å™¨å¯èƒ½ä¸ä¼šé€‰æ‹©ä½¿ç”¨ç´¢å¼•ï¼ˆæˆ–è€…é€‰é”™ç´¢å¼•ï¼‰ï¼Œåè€Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚

**é‚£ä¹ˆï¼Œç”¨äº†ç´¢å¼•å°±ä¸€å®šèƒ½æé«˜æŸ¥è¯¢æ€§èƒ½å—ï¼Ÿ**

**ä¸ä¸€å®šã€‚** å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåˆç†ä½¿ç”¨ç´¢å¼•ç¡®å®æ¯”å…¨è¡¨æ‰«æå¿«å¾—å¤šã€‚ä½†ä¹Ÿæœ‰ä¾‹å¤–ï¼š

- **æ•°æ®é‡å¤ªå°**ï¼šå¦‚æœè¡¨é‡Œçš„æ•°æ®éå¸¸å°‘ï¼ˆæ¯”å¦‚å°±å‡ ç™¾æ¡ï¼‰ï¼Œå…¨è¡¨æ‰«æå¯èƒ½æ¯”é€šè¿‡ç´¢å¼•æŸ¥æ‰¾æ›´å¿«ï¼Œå› ä¸ºèµ°ç´¢å¼•æœ¬èº«ä¹Ÿæœ‰å¼€é”€ã€‚
- **æŸ¥è¯¢ç»“æœé›†å æ¯”è¿‡å¤§**ï¼šå¦‚æœè¦æŸ¥è¯¢çš„æ•°æ®å äº†æ•´å¼ è¡¨çš„å¤§éƒ¨åˆ†ï¼ˆæ¯”å¦‚è¶…è¿‡ 20%-30%ï¼‰ï¼Œä¼˜åŒ–å™¨å¯èƒ½ä¼šè®¤ä¸ºå…¨è¡¨æ‰«ææ›´åˆ’ç®—ï¼Œå› ä¸ºé€šè¿‡ç´¢å¼•å¤šæ¬¡å›è¡¨ï¼ˆéšæœº I/Oï¼‰çš„æˆæœ¬å¯èƒ½é«˜äºä¸€æ¬¡é¡ºåºçš„å…¨è¡¨æ‰«æã€‚
- **ç´¢å¼•ç»´æŠ¤ä¸å½“æˆ–ç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶**ï¼šå¯¼è‡´ä¼˜åŒ–å™¨åšå‡ºé”™è¯¯åˆ¤æ–­ã€‚

### ç´¢å¼•ä¸ºä»€ä¹ˆå¿«ï¼Ÿ

ç´¢å¼•ä¹‹æ‰€ä»¥å¿«ï¼Œæ ¸å¿ƒåŸå› æ˜¯å®ƒ**å¤§å¤§å‡å°‘äº†ç£ç›˜ I/O çš„æ¬¡æ•°**ã€‚

å®ƒçš„æœ¬è´¨æ˜¯ä¸€ç§**æ’å¥½åºçš„æ•°æ®ç»“æ„**ï¼Œå°±åƒä¹¦çš„ç›®å½•ï¼Œè®©æˆ‘ä»¬ä¸ç”¨ä¸€é¡µä¸€é¡µåœ°ç¿»ï¼ˆå…¨è¡¨æ‰«æï¼‰ã€‚

åœ¨ MySQL ä¸­ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„æ˜¯**B+æ ‘**ã€‚B+æ ‘ç»“æ„ä¸»è¦ä»ä¸¤æ–¹é¢åšäº†ä¼˜åŒ–ï¼š

1. B+æ ‘çš„ç‰¹ç‚¹æ˜¯â€œçŸ®èƒ–â€ï¼Œä¸€ä¸ªåƒä¸‡æ•°æ®çš„è¡¨ï¼Œç´¢å¼•æ ‘çš„é«˜åº¦å¯èƒ½åªæœ‰ 3-4 å±‚ã€‚è¿™æ„å‘³ç€ï¼Œæœ€å¤šåªéœ€è¦**3-4 æ¬¡ç£ç›˜ I/O**ï¼Œå°±èƒ½ç²¾ç¡®å®šä½åˆ°æˆ‘æƒ³è¦çš„æ•°æ®ï¼Œè€Œå…¨è¡¨æ‰«æå¯èƒ½éœ€è¦æˆåƒä¸Šä¸‡æ¬¡ï¼Œæ‰€ä»¥é€Ÿåº¦æå¿«ã€‚
2. B+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯**ç”¨é“¾è¡¨è¿èµ·æ¥çš„**ã€‚æ‰¾åˆ°å¼€å¤´åï¼Œå°±èƒ½é¡ºç€é“¾è¡¨**é¡ºåºè¯»**ä¸‹å»ï¼Œè¿™å¯¹ç£ç›˜éå¸¸å‹å¥½ï¼Œè¿˜èƒ½è§¦å‘é¢„è¯»ã€‚

### MySQL ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ MySQL ä¸­ï¼ŒMyISAM å¼•æ“å’Œ InnoDB å¼•æ“éƒ½æ˜¯ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒç¬”è€…å†™çš„è¿™ç¯‡æ–‡ç« ï¼š[MySQL ç´¢å¼•è¯¦è§£](https://javaguide.cn/database/mysql/mysql-index.html)ã€‚

### ä¸ºä»€ä¹ˆ InnoDB æ²¡æœ‰ä½¿ç”¨å“ˆå¸Œä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ

> æˆ‘å‘ç°å¾ˆå¤šæ±‚èŒè€…ç”šè‡³æ˜¯é¢è¯•å®˜å¯¹è¿™ä¸ªé—®é¢˜éƒ½æœ‰è¯¯è§£ï¼Œä»–ä»¬ç›¸å½“ç„¶çš„è®¤ä¸º MySQL åº•å±‚å¹¶æ²¡æœ‰ä½¿ç”¨å“ˆå¸Œæˆ–è€… B æ ‘ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚
>
> å®é™…ä¸Šï¼Œä¸è®ºæ˜¯æé—®è¿˜æ˜¯å›ç­”è¿™ä¸ªé—®é¢˜éƒ½è¦åŒºåˆ†å¥½å­˜å‚¨å¼•æ“ã€‚åƒ MEMORY å¼•æ“å°±åŒæ—¶æ”¯æŒå“ˆå¸Œå’Œ B æ ‘ã€‚

å“ˆå¸Œç´¢å¼•çš„åº•å±‚æ˜¯å“ˆå¸Œè¡¨ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¿›è¡Œ**ç²¾ç¡®çš„ç­‰å€¼æŸ¥è¯¢**æ—¶ï¼Œç†è®ºä¸Šæ—¶é—´å¤æ‚åº¦æ˜¯ **O(1)** ï¼Œé€Ÿåº¦æå¿«ã€‚æ¯”å¦‚ `WHERE id = 123`ã€‚

ä½†æ˜¯ï¼Œå®ƒæœ‰å‡ ä¸ªå¯¹äºé€šç”¨æ•°æ®åº“æ¥è¯´æ˜¯è‡´å‘½çš„ç¼ºç‚¹ï¼š

1. **ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢:** è¿™æ˜¯æœ€ä¸»è¦çš„åŸå› ã€‚å“ˆå¸Œå‡½æ•°çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯å®ƒä¼šæŠŠç›¸é‚»çš„è¾“å…¥å€¼ï¼ˆæ¯”å¦‚ `id=100` å’Œ `id=101`ï¼‰æ˜ å°„åˆ°å“ˆå¸Œè¡¨ä¸­å®Œå…¨ä¸ç›¸é‚»çš„ä½ç½®ã€‚è¿™ç§é¡ºåºçš„ç ´åï¼Œä½¿å¾—æˆ‘ä»¬æ— æ³•å¤„ç†åƒ `WHERE age > 30` æˆ– `BETWEEN 100 AND 200`è¿™æ ·çš„èŒƒå›´æŸ¥è¯¢ã€‚è¦å®Œæˆè¿™ç§æŸ¥è¯¢ï¼Œå“ˆå¸Œç´¢å¼•åªèƒ½é€€åŒ–ä¸ºå…¨è¡¨æ‰«æã€‚
2. **ä¸æ”¯æŒæ’åº:** åŒç†ï¼Œå› ä¸ºå“ˆå¸Œå€¼æ˜¯æ— åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•åˆ©ç”¨å“ˆå¸Œç´¢å¼•æ¥ä¼˜åŒ– `ORDER BY` å­å¥ã€‚
3. **ä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•é”®æŸ¥è¯¢:** å¯¹äºè”åˆç´¢å¼•ï¼Œæ¯”å¦‚`(col1, col2)`ï¼Œå“ˆå¸Œç´¢å¼•å¿…é¡»ä½¿ç”¨æ‰€æœ‰ç´¢å¼•åˆ—è¿›è¡ŒæŸ¥è¯¢ï¼Œå®ƒæ— æ³•å•ç‹¬åˆ©ç”¨ `col1` æ¥åŠ é€ŸæŸ¥è¯¢ã€‚
4. **å“ˆå¸Œå†²çªé—®é¢˜:** å½“ä¸åŒçš„é”®äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼æ—¶ï¼Œéœ€è¦é¢å¤–çš„é“¾è¡¨æˆ–å¼€æ”¾å¯»å€æ¥è§£å†³ï¼Œè¿™ä¼šé™ä½æ€§èƒ½ã€‚

é‰´äºæ•°æ®åº“æŸ¥è¯¢ä¸­èŒƒå›´æŸ¥è¯¢å’Œæ’åºæ˜¯æå…¶å¸¸è§çš„æ“ä½œï¼Œä¸€ä¸ªä¸æ”¯æŒè¿™äº›åŠŸèƒ½çš„ç´¢å¼•ç»“æ„ï¼Œæ˜¾ç„¶ä¸èƒ½ä½œä¸ºé»˜è®¤çš„ã€é€šç”¨çš„ç´¢å¼•ç±»å‹ã€‚

### ä¸ºä»€ä¹ˆ InnoDB æ²¡æœ‰ä½¿ç”¨ B æ ‘ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ

B æ ‘å’Œ B+æ ‘éƒ½æ˜¯ä¼˜ç§€çš„å¤šè·¯å¹³è¡¡æœç´¢æ ‘ï¼Œéå¸¸é€‚åˆç£ç›˜å­˜å‚¨ï¼Œå› ä¸ºå®ƒä»¬éƒ½å¾ˆâ€œçŸ®èƒ–â€ï¼Œèƒ½æœ€å¤§åŒ–åœ°åˆ©ç”¨æ¯ä¸€æ¬¡ç£ç›˜ I/Oã€‚

ä½† B+æ ‘æ˜¯ B æ ‘çš„ä¸€ä¸ªå¢å¼ºç‰ˆï¼Œå®ƒé’ˆå¯¹æ•°æ®åº“åœºæ™¯åšäº†å‡ ä¸ªå…³é”®ä¼˜åŒ–ï¼š

1. **I/O æ•ˆç‡æ›´é«˜:** åœ¨ B+æ ‘ä¸­ï¼Œåªæœ‰å¶å­èŠ‚ç‚¹æ‰å­˜å‚¨æ•°æ®ï¼ˆæˆ–æ•°æ®æŒ‡é’ˆï¼‰ï¼Œè€Œéå¶å­èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•é”®ã€‚å› ä¸ºéå¶å­èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥å®¹çº³æ›´å¤šçš„ç´¢å¼•é”®ã€‚è¿™æ„å‘³ç€ B+æ ‘çš„â€œæ‰‡å‡ºâ€æ›´å¤§ï¼Œåœ¨åŒæ ·çš„æ•°æ®é‡ä¸‹ï¼ŒB+æ ‘é€šå¸¸ä¼šæ¯” B æ ‘æ›´çŸ®ï¼Œä¹Ÿå°±æ„å‘³ç€æŸ¥æ‰¾æ•°æ®æ‰€éœ€çš„ç£ç›˜ I/O æ¬¡æ•°æ›´å°‘ã€‚
2. **æŸ¥è¯¢æ€§èƒ½æ›´ç¨³å®š:** åœ¨ B+æ ‘ä¸­ï¼Œä»»ä½•ä¸€æ¬¡æŸ¥è¯¢éƒ½å¿…é¡»ä»æ ¹èŠ‚ç‚¹èµ°åˆ°å¶å­èŠ‚ç‚¹æ‰èƒ½æ‰¾åˆ°æ•°æ®ï¼Œæ‰€ä»¥æŸ¥è¯¢è·¯å¾„çš„é•¿åº¦æ˜¯å›ºå®šçš„ã€‚è€Œåœ¨ B æ ‘ä¸­ï¼Œå¦‚æœè¿æ°”å¥½ï¼Œå¯èƒ½åœ¨éå¶å­èŠ‚ç‚¹å°±æ‰¾åˆ°äº†æ•°æ®ï¼Œä½†è¿æ°”ä¸å¥½ä¹Ÿå¾—èµ°åˆ°å¶å­ï¼Œè¿™å¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸ç¨³å®šã€‚
3. **å¯¹èŒƒå›´æŸ¥è¯¢æå…¶å‹å¥½:** è¿™æ˜¯ B+æ ‘æœ€æ ¸å¿ƒçš„ä¼˜åŠ¿ã€‚å®ƒçš„æ‰€æœ‰å¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡ä¸€ä¸ªåŒå‘é“¾è¡¨è¿æ¥ã€‚å½“æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ˆæ¯”å¦‚ `WHERE id > 100`ï¼‰æ—¶ï¼Œåªéœ€è¦é€šè¿‡æ ‘å½¢ç»“æ„æ‰¾åˆ° `id=100` çš„å¶å­èŠ‚ç‚¹ï¼Œç„¶åå°±å¯ä»¥æ²¿ç€é“¾è¡¨å‘åé¡ºåºæ‰«æï¼Œè€Œæ— éœ€å†å›æº¯åˆ°ä¸Šå±‚èŠ‚ç‚¹ã€‚è¿™ä½¿å¾—èŒƒå›´æŸ¥è¯¢çš„æ•ˆç‡å¤§å¤§æé«˜ã€‚

### ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ

å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆæˆ–è€…è¯´è¦†ç›–ï¼‰æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸º **è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰**ã€‚

åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œéä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«çš„æ˜¯ä¸»é”®çš„å€¼ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä½¿ç”¨éä¸»é”®ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ•°æ®åº“ä¼šå…ˆæ‰¾åˆ°å¯¹åº”çš„ä¸»é”®å€¼ï¼Œç„¶åå†é€šè¿‡ä¸»é”®ç´¢å¼•æ¥å®šä½å’Œæ£€ç´¢å®Œæ•´çš„è¡Œæ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œå›è¡¨â€ã€‚

**è¦†ç›–ç´¢å¼•å³éœ€è¦æŸ¥è¯¢çš„å­—æ®µæ­£å¥½æ˜¯ç´¢å¼•çš„å­—æ®µï¼Œé‚£ä¹ˆç›´æ¥æ ¹æ®è¯¥ç´¢å¼•ï¼Œå°±å¯ä»¥æŸ¥åˆ°æ•°æ®äº†ï¼Œè€Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚**

### è¯·è§£é‡Šä¸€ä¸‹ MySQL çš„è”åˆç´¢å¼•åŠå…¶æœ€å·¦å‰ç¼€åŸåˆ™

ä½¿ç”¨è¡¨ä¸­çš„å¤šä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œå°±æ˜¯ **è”åˆç´¢å¼•**ï¼Œä¹Ÿå« **ç»„åˆç´¢å¼•** æˆ– **å¤åˆç´¢å¼•**ã€‚

ä»¥ `score` å’Œ `name` ä¸¤ä¸ªå­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼š

```sql
ALTER TABLE `cus_order` ADD INDEX id_score_name(score, name);
```

æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™æŒ‡çš„æ˜¯åœ¨ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼ŒMySQL ä¼šæ ¹æ®ç´¢å¼•ä¸­çš„å­—æ®µé¡ºåºï¼Œä»å·¦åˆ°å³ä¾æ¬¡åŒ¹é…æŸ¥è¯¢æ¡ä»¶ä¸­çš„å­—æ®µã€‚å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸ç´¢å¼•ä¸­çš„æœ€å·¦ä¾§å­—æ®µç›¸åŒ¹é…ï¼Œé‚£ä¹ˆ MySQL å°±ä¼šä½¿ç”¨ç´¢å¼•æ¥è¿‡æ»¤æ•°æ®ï¼Œè¿™æ ·å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚

æœ€å·¦åŒ¹é…åŸåˆ™ä¼šä¸€ç›´å‘å³åŒ¹é…ï¼Œç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ >ã€<ï¼‰ä¸ºæ­¢ã€‚å¯¹äº >=ã€<=ã€BETWEEN ä»¥åŠå‰ç¼€åŒ¹é… LIKE çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¸ä¼šåœæ­¢åŒ¹é…ï¼ˆç›¸å…³é˜…è¯»ï¼š[è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™å…¨ç½‘éƒ½åœ¨è¯´çš„ä¸€ä¸ªé”™è¯¯ç»“è®º](https://mp.weixin.qq.com/s/8qemhRg5MgXs1So5YCv0fQ)ï¼‰ã€‚

å‡è®¾æœ‰ä¸€ä¸ªè”åˆç´¢å¼• `(column1, column2, column3)`ï¼Œå…¶ä»å·¦åˆ°å³çš„æ‰€æœ‰å‰ç¼€ä¸º `(column1)`ã€`(column1, column2)`ã€`(column1, column2, column3)`ï¼ˆåˆ›å»º 1 ä¸ªè”åˆç´¢å¼•ç›¸å½“äºåˆ›å»ºäº† 3 ä¸ªç´¢å¼•ï¼‰ï¼ŒåŒ…å«è¿™äº›åˆ—çš„æ‰€æœ‰æŸ¥è¯¢éƒ½ä¼šèµ°ç´¢å¼•è€Œä¸ä¼šå…¨è¡¨æ‰«æã€‚

æˆ‘ä»¬åœ¨ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œå¯ä»¥å°†åŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨æœ€å·¦è¾¹ï¼Œè¿™ä¹Ÿå¯ä»¥è¿‡æ»¤æ›´å¤šæ•°æ®ã€‚

æˆ‘ä»¬è¿™é‡Œç®€å•æ¼”ç¤ºä¸€ä¸‹æœ€å·¦å‰ç¼€åŒ¹é…çš„æ•ˆæœã€‚

1ã€åˆ›å»ºä¸€ä¸ªåä¸º `student` çš„è¡¨ï¼Œè¿™å¼ è¡¨åªæœ‰ `id`ã€`name`ã€`class` è¿™ 3 ä¸ªå­—æ®µã€‚

```sql
CREATE TABLE `student` (
  `id` int NOT NULL,
  `name` varchar(100) DEFAULT NULL,
  `class` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `name_class_idx` (`name`,`class`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

2ã€ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æµ‹è¯•ä¸‰æ¡ä¸åŒçš„ SQL è¯­å¥ã€‚

![](https://oss.javaguide.cn/github/javaguide/database/mysql/leftmost-prefix-matching-rule.png)

```sql
# å¯ä»¥å‘½ä¸­ç´¢å¼•
SELECT * FROM student WHERE name = 'Anne Henry';
EXPLAIN SELECT * FROM student WHERE name = 'Anne Henry' AND class = 'lIrm08RYVk';
# æ— æ³•å‘½ä¸­ç´¢å¼•
SELECT * FROM student WHERE class = 'lIrm08RYVk';
```

å†æ¥çœ‹ä¸€ä¸ªå¸¸è§çš„é¢è¯•é¢˜ï¼šå¦‚æœæœ‰ç´¢å¼• `è”åˆç´¢å¼•ï¼ˆaï¼Œbï¼Œcï¼‰`ï¼ŒæŸ¥è¯¢ `a=1 AND c=1` ä¼šèµ°ç´¢å¼•ä¹ˆï¼Ÿ`c=1` å‘¢ï¼Ÿ`b=1 AND c=1` å‘¢ï¼Ÿ `b = 1 AND a = 1 AND c = 1` å‘¢ï¼Ÿ

å…ˆä¸è¦å¾€ä¸‹çœ‹ç­”æ¡ˆï¼Œç»™è‡ªå·± 3 åˆ†é’Ÿæ—¶é—´æƒ³ä¸€æƒ³ã€‚

1. æŸ¥è¯¢ `a=1 AND c=1`ï¼šæ ¹æ®æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼ŒæŸ¥è¯¢å¯ä»¥ä½¿ç”¨ç´¢å¼•çš„å‰ç¼€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œè¯¥æŸ¥è¯¢ä»…åœ¨ `a=1` ä¸Šä½¿ç”¨ç´¢å¼•ï¼Œç„¶åå¯¹ç»“æœè¿›è¡Œ `c=1` çš„è¿‡æ»¤ã€‚
2. æŸ¥è¯¢ `c=1`ï¼šç”±äºæŸ¥è¯¢ä¸­ä¸åŒ…å«æœ€å·¦åˆ— `a`ï¼Œæ ¹æ®æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œæ•´ä¸ªç´¢å¼•éƒ½æ— æ³•è¢«ä½¿ç”¨ã€‚
3. æŸ¥è¯¢ `b=1 AND c=1`ï¼šå’Œç¬¬äºŒç§ä¸€æ ·çš„æƒ…å†µï¼Œæ•´ä¸ªç´¢å¼•éƒ½ä¸ä¼šä½¿ç”¨ã€‚
4. æŸ¥è¯¢ `b=1 AND a=1 AND c=1`ï¼šè¿™ä¸ªæŸ¥è¯¢æ˜¯å¯ä»¥ç”¨åˆ°ç´¢å¼•çš„ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨åˆ†æ SQL è¯­å¥æ—¶ï¼Œå¯¹äºè”åˆç´¢å¼•ï¼Œä¼šå¯¹æŸ¥è¯¢æ¡ä»¶è¿›è¡Œé‡æ’åºï¼Œä»¥ä¾¿ç”¨åˆ°ç´¢å¼•ã€‚ä¼šå°† `b=1` å’Œ `a=1` çš„æ¡ä»¶è¿›è¡Œé‡æ’åºï¼Œå˜æˆ `a=1 AND b=1 AND c=1`ã€‚

MySQL 8.0.13 ç‰ˆæœ¬å¼•å…¥äº†ç´¢å¼•è·³è·ƒæ‰«æï¼ˆIndex Skip Scanï¼Œç®€ç§° ISSï¼‰ï¼Œå®ƒå¯ä»¥åœ¨æŸäº›ç´¢å¼•æŸ¥è¯¢åœºæ™¯ä¸‹æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚åœ¨æ²¡æœ‰ ISS ä¹‹å‰ï¼Œä¸æ»¡è¶³æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™çš„è”åˆç´¢å¼•æŸ¥è¯¢ä¸­ä¼šæ‰§è¡Œå…¨è¡¨æ‰«æã€‚è€Œ ISS å…è®¸ MySQL åœ¨æŸäº›æƒ…å†µä¸‹é¿å…å…¨è¡¨æ‰«æï¼Œå³ä½¿æŸ¥è¯¢æ¡ä»¶ä¸ç¬¦åˆæœ€å·¦å‰ç¼€ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒé¸¡è‚‹ï¼Œ å’Œ Oracle ä¸­çš„æ²¡æ³•æ¯”ï¼ŒMySQL 8.0.31 è¿˜æŠ¥å‘Šäº†ä¸€ä¸ª bugï¼š[Bug #109145 Using index for skip scan cause incorrect result](https://bugs.mysql.com/bug.php?id=109145)ï¼ˆåç»­ç‰ˆæœ¬å·²ç»ä¿®å¤ï¼‰ã€‚ä¸ªäººå»ºè®®çŸ¥é“æœ‰è¿™ä¸ªä¸œè¥¿å°±å¥½ï¼Œä¸éœ€è¦æ·±ç©¶ï¼Œå®é™…é¡¹ç›®ä¹Ÿä¸ä¸€å®šèƒ½ç”¨ä¸Šã€‚

### SELECT \* ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆå—ï¼Ÿ

`SELECT *` ä¸ä¼šç›´æ¥å¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼ˆå¦‚æœä¸èµ°ç´¢å¼•å¤§æ¦‚ç‡æ˜¯å› ä¸º where æŸ¥è¯¢èŒƒå›´è¿‡å¤§å¯¼è‡´çš„ï¼‰ï¼Œä½†å®ƒå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›å…¶ä»–çš„æ€§èƒ½é—®é¢˜æ¯”å¦‚é€ æˆç½‘ç»œä¼ è¾“å’Œæ•°æ®å¤„ç†çš„æµªè´¹ã€æ— æ³•ä½¿ç”¨ç´¢å¼•è¦†ç›–ã€‚

### å“ªäº›å­—æ®µé€‚åˆåˆ›å»ºç´¢å¼•ï¼Ÿ

- **ä¸ä¸º NULL çš„å­—æ®µ**ï¼šç´¢å¼•å­—æ®µçš„æ•°æ®åº”è¯¥å°½é‡ä¸ä¸º NULLï¼Œå› ä¸ºå¯¹äºæ•°æ®ä¸º NULL çš„å­—æ®µï¼Œæ•°æ®åº“è¾ƒéš¾ä¼˜åŒ–ã€‚å¦‚æœå­—æ®µé¢‘ç¹è¢«æŸ¥è¯¢ï¼Œä½†åˆé¿å…ä¸äº†ä¸º NULLï¼Œå»ºè®®ä½¿ç”¨ 0,1,true,false è¿™æ ·è¯­ä¹‰è¾ƒä¸ºæ¸…æ™°çš„çŸ­å€¼æˆ–çŸ­å­—ç¬¦ä½œä¸ºæ›¿ä»£ã€‚
- **è¢«é¢‘ç¹æŸ¥è¯¢çš„å­—æ®µ**ï¼šæˆ‘ä»¬åˆ›å»ºç´¢å¼•çš„å­—æ®µåº”è¯¥æ˜¯æŸ¥è¯¢æ“ä½œéå¸¸é¢‘ç¹çš„å­—æ®µã€‚
- **è¢«ä½œä¸ºæ¡ä»¶æŸ¥è¯¢çš„å­—æ®µ**ï¼šè¢«ä½œä¸º WHERE æ¡ä»¶æŸ¥è¯¢çš„å­—æ®µï¼Œåº”è¯¥è¢«è€ƒè™‘å»ºç«‹ç´¢å¼•ã€‚
- **é¢‘ç¹éœ€è¦æ’åºçš„å­—æ®µ**ï¼šç´¢å¼•å·²ç»æ’åºï¼Œè¿™æ ·æŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„æ’åºï¼ŒåŠ å¿«æ’åºæŸ¥è¯¢æ—¶é—´ã€‚
- **è¢«ç»å¸¸é¢‘ç¹ç”¨äºè¿æ¥çš„å­—æ®µ**ï¼šç»å¸¸ç”¨äºè¿æ¥çš„å­—æ®µå¯èƒ½æ˜¯ä¸€äº›å¤–é”®åˆ—ï¼Œå¯¹äºå¤–é”®åˆ—å¹¶ä¸ä¸€å®šè¦å»ºç«‹å¤–é”®ï¼Œåªæ˜¯è¯´è¯¥åˆ—æ¶‰åŠåˆ°è¡¨ä¸è¡¨çš„å…³ç³»ã€‚å¯¹äºé¢‘ç¹è¢«è¿æ¥æŸ¥è¯¢çš„å­—æ®µï¼Œå¯ä»¥è€ƒè™‘å»ºç«‹ç´¢å¼•ï¼Œæé«˜å¤šè¡¨è¿æ¥æŸ¥è¯¢çš„æ•ˆç‡ã€‚

### ç´¢å¼•å¤±æ•ˆçš„åŸå› æœ‰å“ªäº›ï¼Ÿ

1. åˆ›å»ºäº†ç»„åˆç´¢å¼•ï¼Œä½†æŸ¥è¯¢æ¡ä»¶æœªéµå®ˆæœ€å·¦åŒ¹é…åŸåˆ™;
2. åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ç­‰æ“ä½œ;
3. ä»¥ % å¼€å¤´çš„ LIKE æŸ¥è¯¢æ¯”å¦‚ `LIKE '%abc';`;
4. æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨ ORï¼Œä¸” OR çš„å‰åæ¡ä»¶ä¸­æœ‰ä¸€ä¸ªåˆ—æ²¡æœ‰ç´¢å¼•ï¼Œæ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ä½¿ç”¨åˆ°;
5. IN çš„å–å€¼èŒƒå›´è¾ƒå¤§æ—¶ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œèµ°å…¨è¡¨æ‰«æ(NOT IN å’Œ IN çš„å¤±æ•ˆåœºæ™¯ç›¸åŒ);
6. å‘ç”Ÿ[éšå¼è½¬æ¢](https://javaguide.cn/database/mysql/index-invalidation-caused-by-implicit-conversion.html "éšå¼è½¬æ¢");

## MySQL æŸ¥è¯¢ç¼“å­˜

MySQL æŸ¥è¯¢ç¼“å­˜æ˜¯æŸ¥è¯¢ç»“æœç¼“å­˜ã€‚æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰å¯¹åº”çš„æŸ¥è¯¢ç»“æœï¼Œå°±ä¼šç›´æ¥è¿”å›ã€‚

`my.cnf` åŠ å…¥ä»¥ä¸‹é…ç½®ï¼Œé‡å¯ MySQL å¼€å¯æŸ¥è¯¢ç¼“å­˜

```properties
query_cache_type=1
query_cache_size=600000
```

MySQL æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¹Ÿå¯ä»¥å¼€å¯æŸ¥è¯¢ç¼“å­˜

```properties
set global  query_cache_type=1;
set global  query_cache_size=600000;
```

æŸ¥è¯¢ç¼“å­˜ä¼šåœ¨åŒæ ·çš„æŸ¥è¯¢æ¡ä»¶å’Œæ•°æ®æƒ…å†µä¸‹ï¼Œç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„ç»“æœã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„åŒ¹é…æ¡ä»¶éå¸¸ä¸¥æ ¼ï¼Œä»»ä½•ç»†å¾®çš„å·®å¼‚éƒ½ä¼šå¯¼è‡´ç¼“å­˜æ— æ³•å‘½ä¸­ã€‚è¿™é‡Œçš„æŸ¥è¯¢æ¡ä»¶åŒ…æ‹¬æŸ¥è¯¢è¯­å¥æœ¬èº«ã€å½“å‰ä½¿ç”¨çš„æ•°æ®åº“ã€ä»¥åŠå…¶ä»–å¯èƒ½å½±å“ç»“æœçš„å› ç´ ï¼Œå¦‚å®¢æˆ·ç«¯åè®®ç‰ˆæœ¬å·ç­‰ã€‚

**æŸ¥è¯¢ç¼“å­˜ä¸å‘½ä¸­çš„æƒ…å†µï¼š**

1. ä»»ä½•ä¸¤ä¸ªæŸ¥è¯¢åœ¨ä»»ä½•å­—ç¬¦ä¸Šçš„ä¸åŒéƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸å‘½ä¸­ã€‚
2. å¦‚æœæŸ¥è¯¢ä¸­åŒ…å«ä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€å­˜å‚¨å‡½æ•°ã€ç”¨æˆ·å˜é‡ã€ä¸´æ—¶è¡¨ã€MySQL åº“ä¸­çš„ç³»ç»Ÿè¡¨ï¼Œå…¶æŸ¥è¯¢ç»“æœä¹Ÿä¸ä¼šè¢«ç¼“å­˜ã€‚
3. ç¼“å­˜å»ºç«‹ä¹‹åï¼ŒMySQL çš„æŸ¥è¯¢ç¼“å­˜ç³»ç»Ÿä¼šè·Ÿè¸ªæŸ¥è¯¢ä¸­æ¶‰åŠçš„æ¯å¼ è¡¨ï¼Œå¦‚æœè¿™äº›è¡¨ï¼ˆæ•°æ®æˆ–ç»“æ„ï¼‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå’Œè¿™å¼ è¡¨ç›¸å…³çš„æ‰€æœ‰ç¼“å­˜æ•°æ®éƒ½å°†å¤±æ•ˆã€‚

**ç¼“å­˜è™½ç„¶èƒ½å¤Ÿæå‡æ•°æ®åº“çš„æŸ¥è¯¢æ€§èƒ½ï¼Œä½†æ˜¯ç¼“å­˜åŒæ—¶ä¹Ÿå¸¦æ¥äº†é¢å¤–çš„å¼€é”€ï¼Œæ¯æ¬¡æŸ¥è¯¢åéƒ½è¦åšä¸€æ¬¡ç¼“å­˜æ“ä½œï¼Œå¤±æ•ˆåè¿˜è¦é”€æ¯ã€‚** å› æ­¤ï¼Œå¼€å¯æŸ¥è¯¢ç¼“å­˜è¦è°¨æ…ï¼Œå°¤å…¶å¯¹äºå†™å¯†é›†çš„åº”ç”¨æ¥è¯´æ›´æ˜¯å¦‚æ­¤ã€‚å¦‚æœå¼€å¯ï¼Œè¦æ³¨æ„åˆç†æ§åˆ¶ç¼“å­˜ç©ºé—´å¤§å°ï¼Œä¸€èˆ¬æ¥è¯´å…¶å¤§å°è®¾ç½®ä¸ºå‡ å MB æ¯”è¾ƒåˆé€‚ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ `sql_cache` å’Œ `sql_no_cache` æ¥æ§åˆ¶æŸä¸ªæŸ¥è¯¢è¯­å¥æ˜¯å¦éœ€è¦ç¼“å­˜ï¼š

```sql
SELECT sql_no_cache COUNT(*) FROM usr;
```

MySQL 5.6 å¼€å§‹ï¼ŒæŸ¥è¯¢ç¼“å­˜å·²é»˜è®¤ç¦ç”¨ã€‚MySQL 8.0 å¼€å§‹ï¼Œå·²ç»ä¸å†æ”¯æŒæŸ¥è¯¢ç¼“å­˜äº†ï¼ˆå…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š[MySQL 8.0: Retiring Support for the Query Cache](https://dev.mysql.com/blog-archive/mysql-8-0-retiring-support-for-the-query-cache/)ï¼‰ã€‚

![MySQL 8.0: Retiring Support for the Query Cache](https://oss.javaguide.cn/github/javaguide/mysql/mysql8.0-retiring-support-for-the-query-cache.png)

## â­ï¸MySQL æ—¥å¿—

ä¸Šè¯‰é—®é¢˜çš„ç­”æ¡ˆå¯ä»¥åœ¨[ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹(ä»˜è´¹ï¼Œç‚¹å‡»é“¾æ¥é¢†å–ä¼˜æƒ å·)](https://javaguide.cn/zhuanlan/java-mian-shi-zhi-bei.html) çš„ **ã€ŒæŠ€æœ¯é¢è¯•é¢˜ç¯‡ã€** ä¸­æ‰¾åˆ°ã€‚

![ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹æŠ€æœ¯é¢è¯•é¢˜ç¯‡](https://oss.javaguide.cn/javamianshizhibei/technical-interview-questions.png)

æ–‡ç« åœ°å€ï¼š<https://www.yuque.com/snailclimb/mf2z3k/zr4kfk> ï¼ˆå¯†ç è·å–ï¼š<https://t.zsxq.com/avfM0>ï¼‰ã€‚

## â­ï¸MySQL äº‹åŠ¡

### ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ

æˆ‘ä»¬è®¾æƒ³ä¸€ä¸ªåœºæ™¯ï¼Œè¿™ä¸ªåœºæ™¯ä¸­æˆ‘ä»¬éœ€è¦æ’å…¥å¤šæ¡ç›¸å…³è”çš„æ•°æ®åˆ°æ•°æ®åº“ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šé‡åˆ°ä¸‹é¢è¿™äº›é—®é¢˜ï¼š

- æ•°æ®åº“ä¸­é€”çªç„¶å› ä¸ºæŸäº›åŸå› æŒ‚æ‰äº†ã€‚
- å®¢æˆ·ç«¯çªç„¶å› ä¸ºç½‘ç»œåŸå› è¿æ¥ä¸ä¸Šæ•°æ®åº“äº†ã€‚
- å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å†™å…¥æ•°æ®åº“ï¼Œè¦†ç›–äº†å½¼æ­¤çš„æ›´æ”¹ã€‚
- â€¦â€¦

ä¸Šé¢çš„ä»»ä½•ä¸€ä¸ªé—®é¢˜éƒ½å¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿå¤„ç†è¿™äº›é—®é¢˜ã€‚äº‹åŠ¡å°±æ˜¯æˆ‘ä»¬æŠ½è±¡å‡ºæ¥ç®€åŒ–è¿™äº›é—®é¢˜çš„é¦–é€‰æœºåˆ¶ã€‚äº‹åŠ¡çš„æ¦‚å¿µèµ·æºäºæ•°æ®åº“ï¼Œç›®å‰ï¼Œå·²ç»æˆä¸ºä¸€ä¸ªæ¯”è¾ƒå¹¿æ³›çš„æ¦‚å¿µã€‚

**ä½•ä¸ºäº‹åŠ¡ï¼Ÿ** ä¸€è¨€è”½ä¹‹ï¼Œ**äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚**

äº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦ 1000 å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œï¼Œè¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»éƒ½æˆåŠŸæˆ–è€…éƒ½å¤±è´¥ã€‚

1. å°†å°æ˜çš„ä½™é¢å‡å°‘ 1000 å…ƒ
2. å°†å°çº¢çš„ä½™é¢å¢åŠ  1000 å…ƒã€‚

äº‹åŠ¡ä¼šæŠŠè¿™ä¸¤ä¸ªæ“ä½œå°±å¯ä»¥çœ‹æˆé€»è¾‘ä¸Šçš„ä¸€ä¸ªæ•´ä½“ï¼Œè¿™ä¸ªæ•´ä½“åŒ…å«çš„æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚è¿™æ ·å°±ä¸ä¼šå‡ºç°å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢å´å¹¶æ²¡æœ‰å¢åŠ çš„æƒ…å†µã€‚

![äº‹åŠ¡ç¤ºæ„å›¾](https://oss.javaguide.cn/github/javaguide/mysql/%E4%BA%8B%E5%8A%A1%E7%A4%BA%E6%84%8F%E5%9B%BE.png)

### ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Ÿ

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨è°ˆè®ºäº‹åŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æŒ‡**åˆ†å¸ƒå¼äº‹åŠ¡**ï¼Œå¾€å¾€æŒ‡çš„å°±æ˜¯**æ•°æ®åº“äº‹åŠ¡**ã€‚

æ•°æ®åº“äº‹åŠ¡åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æ¥è§¦çš„æœ€å¤šäº†ã€‚å¦‚æœä½ çš„é¡¹ç›®å±äºå•ä½“æ¶æ„çš„è¯ï¼Œä½ æ¥è§¦åˆ°çš„å¾€å¾€å°±æ˜¯æ•°æ®åº“äº‹åŠ¡äº†ã€‚

**é‚£æ•°æ®åº“äº‹åŠ¡æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ**

ç®€å•æ¥è¯´ï¼Œæ•°æ®åº“äº‹åŠ¡å¯ä»¥ä¿è¯å¤šä¸ªå¯¹æ•°æ®åº“çš„æ“ä½œï¼ˆä¹Ÿå°±æ˜¯ SQL è¯­å¥ï¼‰æ„æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“ã€‚æ„æˆè¿™ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“çš„è¿™äº›æ•°æ®åº“æ“ä½œéµå¾ªï¼š**è¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸ,è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ** ã€‚

```sql
# å¼€å¯ä¸€ä¸ªäº‹åŠ¡
START TRANSACTION;
# å¤šæ¡ SQL è¯­å¥
SQL1,SQL2...
## æäº¤äº‹åŠ¡
COMMIT;
```

![æ•°æ®åº“äº‹åŠ¡ç¤ºæ„å›¾](https://oss.javaguide.cn/github/javaguide/mysql/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E7%A4%BA%E6%84%8F%E5%9B%BE.png)

å¦å¤–ï¼Œå…³ç³»å‹æ•°æ®åº“ï¼ˆä¾‹å¦‚ï¼š`MySQL`ã€`SQL Server`ã€`Oracle` ç­‰ï¼‰äº‹åŠ¡éƒ½æœ‰ **ACID** ç‰¹æ€§ï¼š

![ACID](https://oss.javaguide.cn/github/javaguide/mysql/ACID.png)

1. **åŸå­æ€§**ï¼ˆ`Atomicity`ï¼‰ï¼šäº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›
2. **ä¸€è‡´æ€§**ï¼ˆ`Consistency`ï¼‰ï¼šæ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œä¾‹å¦‚è½¬è´¦ä¸šåŠ¡ä¸­ï¼Œæ— è®ºäº‹åŠ¡æ˜¯å¦æˆåŠŸï¼Œè½¬è´¦è€…å’Œæ”¶æ¬¾äººçš„æ€»é¢åº”è¯¥æ˜¯ä¸å˜çš„ï¼›
3. **éš”ç¦»æ€§**ï¼ˆ`Isolation`ï¼‰ï¼šå¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›
4. **æŒä¹…æ€§**ï¼ˆ`Durability`ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚

ğŸŒˆ è¿™é‡Œè¦é¢å¤–è¡¥å……ä¸€ç‚¹ï¼š**åªæœ‰ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€åŸå­æ€§ã€éš”ç¦»æ€§ä¹‹åï¼Œä¸€è‡´æ€§æ‰èƒ½å¾—åˆ°ä¿éšœã€‚ä¹Ÿå°±æ˜¯è¯´ Aã€Iã€D æ˜¯æ‰‹æ®µï¼ŒC æ˜¯ç›®çš„ï¼** æƒ³å¿…å¤§å®¶ä¹Ÿå’Œæˆ‘ä¸€æ ·ï¼Œè¢« ACID è¿™ä¸ªæ¦‚å¿µè¢«è¯¯å¯¼äº†å¾ˆä¹…! æˆ‘ä¹Ÿæ˜¯çœ‹å‘¨å¿—æ˜è€å¸ˆçš„å…¬å¼€è¯¾[ã€Šå‘¨å¿—æ˜çš„è½¯ä»¶æ¶æ„è¯¾ã€‹](https://time.geekbang.org/opencourse/intro/100064201)æ‰ææ¸…æ¥šçš„ï¼ˆå¤šçœ‹å¥½ä¹¦ï¼ï¼ï¼ï¼‰ã€‚

![AID->C](https://oss.javaguide.cn/github/javaguide/mysql/AID-%3EC.png)

å¦å¤–ï¼ŒDDIA ä¹Ÿå°±æ˜¯ [ã€ŠDesigning Data-Intensive Applicationï¼ˆæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ï¼‰ã€‹](https://book.douban.com/subject/30329536/) çš„ä½œè€…åœ¨ä»–çš„è¿™æœ¬ä¹¦ä¸­å¦‚æ˜¯è¯´ï¼š

> Atomicity, isolation, and durability are properties of the database, whereas consisâ€
> tency (in the ACID sense) is a property of the application. The application may rely
> on the databaseâ€™s atomicity and isolation properties in order to achieve consistency,
> but itâ€™s not up to the database alone.
>
> ç¿»è¯‘è¿‡æ¥çš„æ„æ€æ˜¯ï¼šåŸå­æ€§ï¼Œéš”ç¦»æ€§å’ŒæŒä¹…æ€§æ˜¯æ•°æ®åº“çš„å±æ€§ï¼Œè€Œä¸€è‡´æ€§ï¼ˆåœ¨ ACID æ„ä¹‰ä¸Šï¼‰æ˜¯åº”ç”¨ç¨‹åºçš„å±æ€§ã€‚åº”ç”¨å¯èƒ½ä¾èµ–æ•°æ®åº“çš„åŸå­æ€§å’Œéš”ç¦»å±æ€§æ¥å®ç°ä¸€è‡´æ€§ï¼Œä½†è¿™å¹¶ä¸ä»…å–å†³äºæ•°æ®åº“ã€‚å› æ­¤ï¼Œå­—æ¯ C ä¸å±äº ACID ã€‚

ã€ŠDesigning Data-Intensive Applicationï¼ˆæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ï¼‰ã€‹è¿™æœ¬ä¹¦å¼ºæ¨ä¸€æ³¢ï¼Œå€¼å¾—è¯»å¾ˆå¤šéï¼è±†ç“£æœ‰æ¥è¿‘ 90% çš„äººçœ‹äº†è¿™æœ¬ä¹¦ä¹‹åç»™äº†äº”æ˜Ÿå¥½è¯„ã€‚å¦å¤–ï¼Œä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬å·²ç»åœ¨ GitHub å¼€æºï¼Œåœ°å€ï¼š[https://github.com/Vonng/ddia](https://github.com/Vonng/ddia) ã€‚

![](https://oss.javaguide.cn/github/javaguide/books/ddia.png)

### å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜?

åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæ“ä½œç›¸åŒçš„æ•°æ®æ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼ˆå¤šä¸ªç”¨æˆ·å¯¹åŒä¸€æ•°æ®è¿›è¡Œæ“ä½œï¼‰ã€‚å¹¶å‘è™½ç„¶æ˜¯å¿…é¡»çš„ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹çš„é—®é¢˜ã€‚

#### è„è¯»ï¼ˆDirty readï¼‰

ä¸€ä¸ªäº‹åŠ¡è¯»å–æ•°æ®å¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™ä¸ªä¿®æ”¹å¯¹å…¶ä»–äº‹åŠ¡æ¥è¯´æ˜¯å¯è§çš„ï¼Œå³ä½¿å½“å‰äº‹åŠ¡æ²¡æœ‰æäº¤ã€‚è¿™æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†è¿™ä¸ªè¿˜æœªæäº¤çš„æ•°æ®ï¼Œä½†ç¬¬ä¸€ä¸ªäº‹åŠ¡çªç„¶å›æ»šï¼Œå¯¼è‡´æ•°æ®å¹¶æ²¡æœ‰è¢«æäº¤åˆ°æ•°æ®åº“ï¼Œé‚£ç¬¬äºŒä¸ªäº‹åŠ¡è¯»å–åˆ°çš„å°±æ˜¯è„æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯è„è¯»çš„ç”±æ¥ã€‚

ä¾‹å¦‚ï¼šäº‹åŠ¡ 1 è¯»å–æŸè¡¨ä¸­çš„æ•°æ® A=20ï¼Œäº‹åŠ¡ 1 ä¿®æ”¹ A=A-1ï¼Œäº‹åŠ¡ 2 è¯»å–åˆ° A = 19,äº‹åŠ¡ 1 å›æ»šå¯¼è‡´å¯¹ A çš„ä¿®æ”¹å¹¶æœªæäº¤åˆ°æ•°æ®åº“ï¼Œ A çš„å€¼è¿˜æ˜¯ 20ã€‚

![è„è¯»](https://oss.javaguide.cn/github/javaguide/database/mysql/concurrency-consistency-issues-dirty-reading.png)

#### ä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰

åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¯¥æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®åï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿä¿®æ”¹äº†è¿™ä¸ªæ•°æ®ã€‚è¿™æ ·ç¬¬ä¸€ä¸ªäº‹åŠ¡å†…çš„ä¿®æ”¹ç»“æœå°±è¢«ä¸¢å¤±ï¼Œå› æ­¤ç§°ä¸ºä¸¢å¤±ä¿®æ”¹ã€‚

ä¾‹å¦‚ï¼šäº‹åŠ¡ 1 è¯»å–æŸè¡¨ä¸­çš„æ•°æ® A=20ï¼Œäº‹åŠ¡ 2 ä¹Ÿè¯»å– A=20ï¼Œäº‹åŠ¡ 1 å…ˆä¿®æ”¹ A=A-1ï¼Œäº‹åŠ¡ 2 åæ¥ä¹Ÿä¿®æ”¹ A=A-1ï¼Œæœ€ç»ˆç»“æœ A=19ï¼Œäº‹åŠ¡ 1 çš„ä¿®æ”¹è¢«ä¸¢å¤±ã€‚

![ä¸¢å¤±ä¿®æ”¹](https://oss.javaguide.cn/github/javaguide/database/mysql/concurrency-consistency-issues-missing-modifications.png)

#### ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatable readï¼‰

æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚è¿™å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå› æ­¤ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚

ä¾‹å¦‚ï¼šäº‹åŠ¡ 1 è¯»å–æŸè¡¨ä¸­çš„æ•°æ® A=20ï¼Œäº‹åŠ¡ 2 ä¹Ÿè¯»å– A=20ï¼Œäº‹åŠ¡ 1 ä¿®æ”¹ A=A-1ï¼Œäº‹åŠ¡ 2 å†æ¬¡è¯»å– A =19ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚

![ä¸å¯é‡å¤è¯»](https://oss.javaguide.cn/github/javaguide/database/mysql/concurrency-consistency-issues-unrepeatable-read.png)

#### å¹»è¯»ï¼ˆPhantom readï¼‰

å¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡å°±ä¼šå‘ç°å¤šäº†ä¸€äº›åŸæœ¬ä¸å­˜åœ¨çš„è®°å½•ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¸ºå¹»è¯»ã€‚

ä¾‹å¦‚ï¼šäº‹åŠ¡ 2 è¯»å–æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼Œäº‹åŠ¡ 1 åœ¨è¿™ä¸ªèŒƒå›´æ’å…¥äº†æ–°çš„æ•°æ®ï¼Œäº‹åŠ¡ 2 å†æ¬¡è¯»å–è¿™ä¸ªèŒƒå›´çš„æ•°æ®å‘ç°ç›¸æ¯”äºç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœå¤šäº†æ–°çš„æ•°æ®ã€‚

![å¹»è¯»](https://oss.javaguide.cn/github/javaguide/database/mysql/concurrency-consistency-issues-phantom-read.png)

### ä¸å¯é‡å¤è¯»å’Œå¹»è¯»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

- ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯å†…å®¹ä¿®æ”¹æˆ–è€…è®°å½•å‡å°‘æ¯”å¦‚å¤šæ¬¡è¯»å–ä¸€æ¡è®°å½•å‘ç°å…¶ä¸­æŸäº›è®°å½•çš„å€¼è¢«ä¿®æ”¹ï¼›
- å¹»è¯»çš„é‡ç‚¹åœ¨äºè®°å½•æ–°å¢æ¯”å¦‚å¤šæ¬¡æ‰§è¡ŒåŒä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼ˆDQLï¼‰æ—¶ï¼Œå‘ç°æŸ¥åˆ°çš„è®°å½•å¢åŠ äº†ã€‚

å¹»è¯»å…¶å®å¯ä»¥çœ‹ä½œæ˜¯ä¸å¯é‡å¤è¯»çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå•ç‹¬æŠŠå¹»è¯»åŒºåˆ†å‡ºæ¥çš„åŸå› ä¸»è¦æ˜¯è§£å†³å¹»è¯»å’Œä¸å¯é‡å¤è¯»çš„æ–¹æ¡ˆä¸ä¸€æ ·ã€‚

ä¸¾ä¸ªä¾‹å­ï¼šæ‰§è¡Œ `delete` å’Œ `update` æ“ä½œçš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥å¯¹è®°å½•åŠ é”ï¼Œä¿è¯äº‹åŠ¡å®‰å…¨ã€‚è€Œæ‰§è¡Œ `insert` æ“ä½œçš„æ—¶å€™ï¼Œç”±äºè®°å½•é”ï¼ˆRecord Lockï¼‰åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è®°å½•ï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è®°å½•ï¼Œéœ€è¦ä¾èµ–é—´éš™é”ï¼ˆGap Lockï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œ `insert` æ“ä½œçš„æ—¶å€™éœ€è¦ä¾èµ– Next-Key Lockï¼ˆRecord Lock+Gap Lockï¼‰ è¿›è¡ŒåŠ é”æ¥ä¿è¯ä¸å‡ºç°å¹»è¯»ã€‚

### å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼æœ‰å“ªäº›ï¼Ÿ

MySQL ä¸­å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼æ— éå°±ä¸¤ç§ï¼š**é”** å’Œ **MVCC**ã€‚é”å¯ä»¥çœ‹ä½œæ˜¯æ‚²è§‚æ§åˆ¶çš„æ¨¡å¼ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼ŒMultiversion concurrency controlï¼‰å¯ä»¥çœ‹ä½œæ˜¯ä¹è§‚æ§åˆ¶çš„æ¨¡å¼ã€‚

**é”** æ§åˆ¶æ–¹å¼ä¸‹ä¼šé€šè¿‡é”æ¥æ˜¾å¼æ§åˆ¶å…±äº«èµ„æºè€Œä¸æ˜¯é€šè¿‡è°ƒåº¦æ‰‹æ®µï¼ŒMySQL ä¸­ä¸»è¦æ˜¯é€šè¿‡ **è¯»å†™é”** æ¥å®ç°å¹¶å‘æ§åˆ¶ã€‚

- **å…±äº«é”ï¼ˆS é”ï¼‰**ï¼šåˆç§°è¯»é”ï¼Œäº‹åŠ¡åœ¨è¯»å–è®°å½•çš„æ—¶å€™è·å–å…±äº«é”ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ï¼ˆé”å…¼å®¹ï¼‰ã€‚
- **æ’ä»–é”ï¼ˆX é”ï¼‰**ï¼šåˆç§°å†™é”/ç‹¬å é”ï¼Œäº‹åŠ¡åœ¨ä¿®æ”¹è®°å½•çš„æ—¶å€™è·å–æ’ä»–é”ï¼Œä¸å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ã€‚å¦‚æœä¸€ä¸ªè®°å½•å·²ç»è¢«åŠ äº†æ’ä»–é”ï¼Œé‚£å…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹è¿™æ¡è®°å½•åŠ ä»»ä½•ç±»å‹çš„é”ï¼ˆé”ä¸å…¼å®¹ï¼‰ã€‚

è¯»å†™é”å¯ä»¥åšåˆ°è¯»è¯»å¹¶è¡Œï¼Œä½†æ˜¯æ— æ³•åšåˆ°å†™è¯»ã€å†™å†™å¹¶è¡Œã€‚å¦å¤–ï¼Œæ ¹æ®æ ¹æ®é”ç²’åº¦çš„ä¸åŒï¼Œåˆè¢«åˆ†ä¸º **è¡¨çº§é”(table-level locking)** å’Œ **è¡Œçº§é”(row-level locking)** ã€‚InnoDB ä¸å…‰æ”¯æŒè¡¨çº§é”ï¼Œè¿˜æ”¯æŒè¡Œçº§é”ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”ã€‚è¡Œçº§é”çš„ç²’åº¦æ›´å°ï¼Œä»…å¯¹ç›¸å…³çš„è®°å½•ä¸Šé”å³å¯ï¼ˆå¯¹ä¸€è¡Œæˆ–è€…å¤šè¡Œè®°å½•åŠ é”ï¼‰ï¼Œæ‰€ä»¥å¯¹äºå¹¶å‘å†™å…¥æ“ä½œæ¥è¯´ï¼Œ InnoDB çš„æ€§èƒ½æ›´é«˜ã€‚ä¸è®ºæ˜¯è¡¨çº§é”è¿˜æ˜¯è¡Œçº§é”ï¼Œéƒ½å­˜åœ¨å…±äº«é”ï¼ˆShare Lockï¼ŒS é”ï¼‰å’Œæ’ä»–é”ï¼ˆExclusive Lockï¼ŒX é”ï¼‰è¿™ä¸¤ç±»ã€‚

**MVCC** æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æ–¹æ³•ï¼Œå³å¯¹ä¸€ä»½æ•°æ®ä¼šå­˜å‚¨å¤šä¸ªç‰ˆæœ¬ï¼Œé€šè¿‡äº‹åŠ¡çš„å¯è§æ€§æ¥ä¿è¯äº‹åŠ¡èƒ½çœ‹åˆ°è‡ªå·±åº”è¯¥çœ‹åˆ°çš„ç‰ˆæœ¬ã€‚é€šå¸¸ä¼šæœ‰ä¸€ä¸ªå…¨å±€çš„ç‰ˆæœ¬åˆ†é…å™¨æ¥ä¸ºæ¯ä¸€è¡Œæ•°æ®è®¾ç½®ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·æ˜¯å”¯ä¸€çš„ã€‚

MVCC åœ¨ MySQL ä¸­å®ç°æ‰€ä¾èµ–çš„æ‰‹æ®µä¸»è¦æ˜¯: **éšè—å­—æ®µã€read viewã€undo log**ã€‚

- undo log : undo log ç”¨äºè®°å½•æŸè¡Œæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬çš„æ•°æ®ã€‚
- read view å’Œ éšè—å­—æ®µ : ç”¨æ¥åˆ¤æ–­å½“å‰ç‰ˆæœ¬æ•°æ®çš„å¯è§æ€§ã€‚

å…³äº InnoDB å¯¹ MVCC çš„å…·ä½“å®ç°å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š[InnoDB å­˜å‚¨å¼•æ“å¯¹ MVCC çš„å®ç°](./innodb-implementation-of-mvcc.md) ã€‚

### SQL æ ‡å‡†å®šä¹‰äº†å“ªäº›äº‹åŠ¡éš”ç¦»çº§åˆ«?

SQL æ ‡å‡†å®šä¹‰äº†å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œç”¨æ¥å¹³è¡¡äº‹åŠ¡çš„éš”ç¦»æ€§ï¼ˆIsolationï¼‰å’Œå¹¶å‘æ€§èƒ½ã€‚çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®ä¸€è‡´æ€§è¶Šå¥½ï¼Œä½†å¹¶å‘æ€§èƒ½å¯èƒ½è¶Šä½ã€‚è¿™å››ä¸ªçº§åˆ«æ˜¯ï¼š

- **READ-UNCOMMITTED(è¯»å–æœªæäº¤)** ï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚è¿™ç§çº§åˆ«åœ¨å®é™…åº”ç”¨ä¸­å¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå¯¹æ•°æ®ä¸€è‡´æ€§çš„ä¿è¯å¤ªå¼±ã€‚
- **READ-COMMITTED(è¯»å–å·²æäº¤)** ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚è¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ï¼ˆå¦‚ Oracle, SQL Serverï¼‰çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚
- **REPEATABLE-READ(å¯é‡å¤è¯»)** ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«æ­£æ˜¯ REPEATABLE READã€‚å¹¶ä¸”ï¼ŒInnoDB åœ¨æ­¤çº§åˆ«ä¸‹é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ å’Œ Next-Key Locksï¼ˆé—´éš™é”+è¡Œé”ï¼‰ æœºåˆ¶ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè§£å†³äº†å¹»è¯»é—®é¢˜ã€‚
- **SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)** ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚

| éš”ç¦»çº§åˆ«         | è„è¯» (Dirty Read) | ä¸å¯é‡å¤è¯» (Non-Repeatable Read) | å¹»è¯» (Phantom Read)    |
| ---------------- | ----------------- | -------------------------------- | ---------------------- |
| READ UNCOMMITTED | âˆš                 | âˆš                                | âˆš                      |
| READ COMMITTED   | Ã—                 | âˆš                                | âˆš                      |
| REPEATABLE READ  | Ã—                 | Ã—                                | âˆš (æ ‡å‡†) / â‰ˆÃ— (InnoDB) |
| SERIALIZABLE     | Ã—                 | Ã—                                | Ã—                      |

### MySQL çš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆ?

MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ **REPEATABLE READ**ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š

- MySQL 8.0 ä¹‹å‰ï¼š`SELECT @@tx_isolation;`
- MySQL 8.0 åŠä¹‹åï¼š`SELECT @@transaction_isolation;`

```sql
mysql> SELECT @@tx_isolation;
+-----------------+
| @@tx_isolation  |
+-----------------+
| REPEATABLE-READ |
+-----------------+
```

å…³äº MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š[MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£](./transaction-isolation-level.md)ã€‚

### MySQL çš„éš”ç¦»çº§åˆ«æ˜¯åŸºäºé”å®ç°çš„å—ï¼Ÿ

MySQL çš„éš”ç¦»çº§åˆ«åŸºäºé”å’Œ MVCC æœºåˆ¶å…±åŒå®ç°çš„ã€‚

SERIALIZABLE éš”ç¦»çº§åˆ«æ˜¯é€šè¿‡é”æ¥å®ç°çš„ï¼ŒREAD-COMMITTED å’Œ REPEATABLE-READ éš”ç¦»çº§åˆ«æ˜¯åŸºäº MVCC å®ç°çš„ã€‚ä¸è¿‡ï¼Œ SERIALIZABLE ä¹‹å¤–çš„å…¶ä»–éš”ç¦»çº§åˆ«å¯èƒ½ä¹Ÿéœ€è¦ç”¨åˆ°é”æœºåˆ¶ï¼Œå°±æ¯”å¦‚ REPEATABLE-READ åœ¨å½“å‰è¯»æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨åŠ é”è¯»æ¥ä¿è¯ä¸ä¼šå‡ºç°å¹»è¯»ã€‚

## MySQL é”

é”æ˜¯ä¸€ç§å¸¸è§çš„å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼ã€‚

### è¡¨çº§é”å’Œè¡Œçº§é”äº†è§£å—ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

MyISAM ä»…ä»…æ”¯æŒè¡¨çº§é”(table-level locking)ï¼Œä¸€é”å°±é”æ•´å¼ è¡¨ï¼Œè¿™åœ¨å¹¶å‘å†™çš„æƒ…å†µä¸‹æ€§éå¸¸å·®ã€‚InnoDB ä¸å…‰æ”¯æŒè¡¨çº§é”(table-level locking)ï¼Œè¿˜æ”¯æŒè¡Œçº§é”(row-level locking)ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”ã€‚

è¡Œçº§é”çš„ç²’åº¦æ›´å°ï¼Œä»…å¯¹ç›¸å…³çš„è®°å½•ä¸Šé”å³å¯ï¼ˆå¯¹ä¸€è¡Œæˆ–è€…å¤šè¡Œè®°å½•åŠ é”ï¼‰ï¼Œæ‰€ä»¥å¯¹äºå¹¶å‘å†™å…¥æ“ä½œæ¥è¯´ï¼Œ InnoDB çš„æ€§èƒ½æ›´é«˜ã€‚

**è¡¨çº§é”å’Œè¡Œçº§é”å¯¹æ¯”**ï¼š

- **è¡¨çº§é”ï¼š** MySQL ä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼ˆå…¨å±€é”é™¤å¤–ï¼‰ï¼Œæ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°‘ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚ä¸è¿‡ï¼Œè§¦å‘é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œé«˜å¹¶å‘ä¸‹æ•ˆç‡æä½ã€‚è¡¨çº§é”å’Œå­˜å‚¨å¼•æ“æ— å…³ï¼ŒMyISAM å’Œ InnoDB å¼•æ“éƒ½æ”¯æŒè¡¨çº§é”ã€‚
- **è¡Œçº§é”ï¼š** MySQL ä¸­é”å®šç²’åº¦æœ€å°çš„ä¸€ç§é”ï¼Œæ˜¯ **é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é”** ï¼Œåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚ è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦é«˜ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”ã€‚è¡Œçº§é”å’Œå­˜å‚¨å¼•æ“æœ‰å…³ï¼Œæ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚é¢å®ç°çš„ã€‚

### è¡Œçº§é”çš„ä½¿ç”¨æœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹ï¼Ÿ

InnoDB çš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œè¡¨çº§é”æ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ `UPDATE`ã€`DELETE` è¯­å¥æ—¶ï¼Œå¦‚æœ `WHERE`æ¡ä»¶ä¸­å­—æ®µæ²¡æœ‰å‘½ä¸­å”¯ä¸€ç´¢å¼•æˆ–è€…ç´¢å¼•å¤±æ•ˆçš„è¯ï¼Œå°±ä¼šå¯¼è‡´æ‰«æå…¨è¡¨å¯¹è¡¨ä¸­çš„æ‰€æœ‰è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚è¿™ä¸ªåœ¨æˆ‘ä»¬æ—¥å¸¸å·¥ä½œå¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°ï¼Œä¸€å®šè¦å¤šå¤šæ³¨æ„ï¼ï¼ï¼

ä¸è¿‡ï¼Œå¾ˆå¤šæ—¶å€™å³ä½¿ç”¨äº†ç´¢å¼•ä¹Ÿæœ‰å¯èƒ½ä¼šèµ°å…¨è¡¨æ‰«æï¼Œè¿™æ˜¯å› ä¸º MySQL ä¼˜åŒ–å™¨çš„åŸå› ã€‚

### InnoDB æœ‰å“ªå‡ ç±»è¡Œé”ï¼Ÿ

InnoDB è¡Œé”æ˜¯é€šè¿‡å¯¹ç´¢å¼•æ•°æ®é¡µä¸Šçš„è®°å½•åŠ é”å®ç°çš„ï¼ŒMySQL InnoDB æ”¯æŒä¸‰ç§è¡Œé”å®šæ–¹å¼ï¼š

- **è®°å½•é”ï¼ˆRecord Lockï¼‰**ï¼šå±äºå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ã€‚
- **é—´éš™é”ï¼ˆGap Lockï¼‰**ï¼šé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚
- **ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰**ï¼šRecord Lock+Gap Lockï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ï¼ˆMySQL äº‹åŠ¡éƒ¨åˆ†æåˆ°è¿‡ï¼‰ã€‚è®°å½•é”åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è®°å½•ï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è®°å½•ï¼Œéœ€è¦ä¾èµ–é—´éš™é”ã€‚

**åœ¨ InnoDB é»˜è®¤çš„éš”ç¦»çº§åˆ« REPEATABLE-READ ä¸‹ï¼Œè¡Œé”é»˜è®¤ä½¿ç”¨çš„æ˜¯ Next-Key Lockã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œçš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•æˆ–ä¸»é”®ï¼ŒInnoDB ä¼šå¯¹ Next-Key Lock è¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶é™çº§ä¸º Record Lockï¼Œå³ä»…é”ä½ç´¢å¼•æœ¬èº«ï¼Œè€Œä¸æ˜¯èŒƒå›´ã€‚**

### å…±äº«é”å’Œæ’ä»–é”å‘¢ï¼Ÿ

ä¸è®ºæ˜¯è¡¨çº§é”è¿˜æ˜¯è¡Œçº§é”ï¼Œéƒ½å­˜åœ¨å…±äº«é”ï¼ˆShare Lockï¼ŒS é”ï¼‰å’Œæ’ä»–é”ï¼ˆExclusive Lockï¼ŒX é”ï¼‰è¿™ä¸¤ç±»ï¼š

- **å…±äº«é”ï¼ˆS é”ï¼‰**ï¼šåˆç§°è¯»é”ï¼Œäº‹åŠ¡åœ¨è¯»å–è®°å½•çš„æ—¶å€™è·å–å…±äº«é”ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ï¼ˆé”å…¼å®¹ï¼‰ã€‚
- **æ’ä»–é”ï¼ˆX é”ï¼‰**ï¼šåˆç§°å†™é”/ç‹¬å é”ï¼Œäº‹åŠ¡åœ¨ä¿®æ”¹è®°å½•çš„æ—¶å€™è·å–æ’ä»–é”ï¼Œä¸å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ã€‚å¦‚æœä¸€ä¸ªè®°å½•å·²ç»è¢«åŠ äº†æ’ä»–é”ï¼Œé‚£å…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹è¿™æ¡äº‹åŠ¡åŠ ä»»ä½•ç±»å‹çš„é”ï¼ˆé”ä¸å…¼å®¹ï¼‰ã€‚

æ’ä»–é”ä¸ä»»ä½•çš„é”éƒ½ä¸å…¼å®¹ï¼Œå…±äº«é”ä»…å’Œå…±äº«é”å…¼å®¹ã€‚

|      | S é”   | X é” |
| :--- | :----- | :--- |
| S é” | ä¸å†²çª | å†²çª |
| X é” | å†²çª   | å†²çª |

ç”±äº MVCC çš„å­˜åœ¨ï¼Œå¯¹äºä¸€èˆ¬çš„ `SELECT` è¯­å¥ï¼ŒInnoDB ä¸ä¼šåŠ ä»»ä½•é”ã€‚ä¸è¿‡ï¼Œ ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥æ˜¾å¼åŠ å…±äº«é”æˆ–æ’ä»–é”ã€‚

```sql
# å…±äº«é” å¯ä»¥åœ¨ MySQL 5.7 å’Œ MySQL 8.0 ä¸­ä½¿ç”¨
SELECT ... LOCK IN SHARE MODE;
# å…±äº«é” å¯ä»¥åœ¨ MySQL 8.0 ä¸­ä½¿ç”¨
SELECT ... FOR SHARE;
# æ’ä»–é”
SELECT ... FOR UPDATE;
```

### æ„å‘é”æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

å¦‚æœéœ€è¦ç”¨åˆ°è¡¨é”çš„è¯ï¼Œå¦‚ä½•åˆ¤æ–­è¡¨ä¸­çš„è®°å½•æ²¡æœ‰è¡Œé”å‘¢ï¼Œä¸€è¡Œä¸€è¡Œéå†è‚¯å®šæ˜¯ä¸è¡Œï¼Œæ€§èƒ½å¤ªå·®ã€‚æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªå«åšæ„å‘é”çš„ä¸œä¸œæ¥å¿«é€Ÿåˆ¤æ–­æ˜¯å¦å¯ä»¥å¯¹æŸä¸ªè¡¨ä½¿ç”¨è¡¨é”ã€‚

æ„å‘é”æ˜¯è¡¨çº§é”ï¼Œå…±æœ‰ä¸¤ç§ï¼š

- **æ„å‘å…±äº«é”ï¼ˆIntention Shared Lockï¼ŒIS é”ï¼‰**ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ å…±äº«é”ï¼ˆS é”ï¼‰ï¼ŒåŠ å…±äº«é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IS é”ã€‚
- **æ„å‘æ’ä»–é”ï¼ˆIntention Exclusive Lockï¼ŒIX é”ï¼‰**ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ æ’ä»–é”ï¼ˆX é”ï¼‰ï¼ŒåŠ æ’ä»–é”ä¹‹å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IX é”ã€‚

**æ„å‘é”æ˜¯ç”±æ•°æ®å¼•æ“è‡ªå·±ç»´æŠ¤çš„ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº«/æ’ä»–é”ä¹‹å‰ï¼ŒInnoDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œæ‰€åœ¨åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”ã€‚**

æ„å‘é”ä¹‹é—´æ˜¯äº’ç›¸å…¼å®¹çš„ã€‚

|       | IS é” | IX é” |
| ----- | ----- | ----- |
| IS é” | å…¼å®¹  | å…¼å®¹  |
| IX é” | å…¼å®¹  | å…¼å®¹  |

æ„å‘é”å’Œå…±äº«é”å’Œæ’å®ƒé”äº’æ–¥ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯è¡¨çº§åˆ«çš„å…±äº«é”å’Œæ’ä»–é”ï¼Œæ„å‘é”ä¸ä¼šä¸è¡Œçº§çš„å…±äº«é”å’Œæ’ä»–é”äº’æ–¥ï¼‰ã€‚

|      | IS é” | IX é” |
| ---- | ----- | ----- |
| S é” | å…¼å®¹  | äº’æ–¥  |
| X é” | äº’æ–¥  | äº’æ–¥  |

ã€ŠMySQL æŠ€æœ¯å†…å¹• InnoDB å­˜å‚¨å¼•æ“ã€‹è¿™æœ¬ä¹¦å¯¹åº”çš„æè¿°åº”è¯¥æ˜¯ç¬”è¯¯äº†ã€‚

![](https://oss.javaguide.cn/github/javaguide/mysql/image-20220511171419081.png)

### å½“å‰è¯»å’Œå¿«ç…§è¯»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å¿«ç…§è¯»**ï¼ˆä¸€è‡´æ€§éé”å®šè¯»ï¼‰å°±æ˜¯å•çº¯çš„ `SELECT` è¯­å¥ï¼Œä½†ä¸åŒ…æ‹¬ä¸‹é¢è¿™ä¸¤ç±» `SELECT` è¯­å¥ï¼š

```sql
SELECT ... FOR UPDATE
# å…±äº«é” å¯ä»¥åœ¨ MySQL 5.7 å’Œ MySQL 8.0 ä¸­ä½¿ç”¨
SELECT ... LOCK IN SHARE MODE;
# å…±äº«é” å¯ä»¥åœ¨ MySQL 8.0 ä¸­ä½¿ç”¨
SELECT ... FOR SHARE;
```

å¿«ç…§å³è®°å½•çš„å†å²ç‰ˆæœ¬ï¼Œæ¯è¡Œè®°å½•å¯èƒ½å­˜åœ¨å¤šä¸ªå†å²ç‰ˆæœ¬ï¼ˆå¤šç‰ˆæœ¬æŠ€æœ¯ï¼‰ã€‚

å¿«ç…§è¯»çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¯»å–çš„è®°å½•æ­£åœ¨æ‰§è¡Œ UPDATE/DELETE æ“ä½œï¼Œè¯»å–æ“ä½œä¸ä¼šå› æ­¤å»ç­‰å¾…è®°å½•ä¸Š X é”çš„é‡Šæ”¾ï¼Œè€Œæ˜¯ä¼šå»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§ã€‚

åªæœ‰åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ« RC(è¯»å–å·²æäº¤) å’Œ RRï¼ˆå¯é‡è¯»ï¼‰ä¸‹ï¼ŒInnoDB æ‰ä¼šä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ï¼š

- åœ¨ RC çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œä¸€è‡´æ€§éé”å®šè¯»æ€»æ˜¯è¯»å–è¢«é”å®šè¡Œçš„æœ€æ–°ä¸€ä»½å¿«ç…§æ•°æ®ã€‚
- åœ¨ RR çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œä¸€è‡´æ€§éé”å®šè¯»æ€»æ˜¯è¯»å–æœ¬äº‹åŠ¡å¼€å§‹æ—¶çš„è¡Œæ•°æ®ç‰ˆæœ¬ã€‚

å¿«ç…§è¯»æ¯”è¾ƒé€‚åˆå¯¹äºæ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜ä¸”è¿½æ±‚æè‡´æ€§èƒ½çš„ä¸šåŠ¡åœºæ™¯ã€‚

**å½“å‰è¯»** ï¼ˆä¸€è‡´æ€§é”å®šè¯»ï¼‰å°±æ˜¯ç»™è¡Œè®°å½•åŠ  X é”æˆ– S é”ã€‚

å½“å‰è¯»çš„ä¸€äº›å¸¸è§ SQL è¯­å¥ç±»å‹å¦‚ä¸‹ï¼š

```sql
# å¯¹è¯»çš„è®°å½•åŠ ä¸€ä¸ªXé”
SELECT...FOR UPDATE
# å¯¹è¯»çš„è®°å½•åŠ ä¸€ä¸ªSé”
SELECT...LOCK IN SHARE MODE
# å¯¹è¯»çš„è®°å½•åŠ ä¸€ä¸ªSé”
SELECT...FOR SHARE
# å¯¹ä¿®æ”¹çš„è®°å½•åŠ ä¸€ä¸ªXé”
INSERT...
UPDATE...
DELETE...
```

### è‡ªå¢é”æœ‰äº†è§£å—ï¼Ÿ

> ä¸å¤ªé‡è¦çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œç®€å•äº†è§£å³å¯ã€‚

å…³ç³»å‹æ•°æ®åº“è®¾è®¡è¡¨çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæœ‰ä¸€åˆ—ä½œä¸ºè‡ªå¢ä¸»é”®ã€‚InnoDB ä¸­çš„è‡ªå¢ä¸»é”®ä¼šæ¶‰åŠä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„è¡¨çº§é”â€” **è‡ªå¢é”ï¼ˆAUTO-INC Locksï¼‰** ã€‚

```sql
CREATE TABLE `sequence_id` (
  `id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
  `stub` CHAR(10) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`),
  UNIQUE KEY `stub` (`stub`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

æ›´å‡†ç¡®ç‚¹æ¥è¯´ï¼Œä¸ä»…ä»…æ˜¯è‡ªå¢ä¸»é”®ï¼Œ`AUTO_INCREMENT`çš„åˆ—éƒ½ä¼šæ¶‰åŠåˆ°è‡ªå¢é”ï¼Œæ¯•ç«Ÿéä¸»é”®ä¹Ÿå¯ä»¥è®¾ç½®è‡ªå¢é•¿ã€‚

å¦‚æœä¸€ä¸ªäº‹åŠ¡æ­£åœ¨æ’å…¥æ•°æ®åˆ°æœ‰è‡ªå¢åˆ—çš„è¡¨æ—¶ï¼Œä¼šå…ˆè·å–è‡ªå¢é”ï¼Œæ‹¿ä¸åˆ°å°±å¯èƒ½ä¼šè¢«é˜»å¡ä½ã€‚è¿™é‡Œçš„é˜»å¡è¡Œä¸ºåªæ˜¯è‡ªå¢é”è¡Œä¸ºçš„å…¶ä¸­ä¸€ç§ï¼Œå¯ä»¥ç†è§£ä¸ºè‡ªå¢é”å°±æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶å…·ä½“çš„å®ç°æœ‰å¤šç§ã€‚å…·ä½“çš„é…ç½®é¡¹ä¸º `innodb_autoinc_lock_mode` ï¼ˆMySQL 5.1.22 å¼•å…¥ï¼‰ï¼Œå¯ä»¥é€‰æ‹©çš„å€¼å¦‚ä¸‹ï¼š

| innodb_autoinc_lock_mode | ä»‹ç»                           |
| :----------------------- | :----------------------------- |
| 0                        | ä¼ ç»Ÿæ¨¡å¼                       |
| 1                        | è¿ç»­æ¨¡å¼ï¼ˆMySQL 8.0 ä¹‹å‰é»˜è®¤ï¼‰ |
| 2                        | äº¤é”™æ¨¡å¼(MySQL 8.0 ä¹‹åé»˜è®¤)   |

äº¤é”™æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„â€œINSERT-LIKEâ€è¯­å¥ï¼ˆæ‰€æœ‰çš„æ’å…¥è¯­å¥ï¼ŒåŒ…æ‹¬ï¼š`INSERT`ã€`REPLACE`ã€`INSERTâ€¦SELECT`ã€`REPLACEâ€¦SELECT`ã€`LOAD DATA`ç­‰ï¼‰éƒ½ä¸ä½¿ç”¨è¡¨çº§é”ï¼Œä½¿ç”¨çš„æ˜¯è½»é‡çº§äº’æ–¥é”å®ç°ï¼Œå¤šæ¡æ’å…¥è¯­å¥å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œé€Ÿåº¦æ›´å¿«ï¼Œæ‰©å±•æ€§ä¹Ÿæ›´å¥½ã€‚

ä¸è¿‡ï¼Œå¦‚æœä½ çš„ MySQL æ•°æ®åº“æœ‰ä¸»ä»åŒæ­¥éœ€æ±‚å¹¶ä¸” Binlog å­˜å‚¨æ ¼å¼ä¸º Statement çš„è¯ï¼Œä¸è¦å°† InnoDB è‡ªå¢é”æ¨¡å¼è®¾ç½®ä¸ºäº¤å‰æ¨¡å¼ï¼Œä¸ç„¶ä¼šæœ‰æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚è¿™æ˜¯å› ä¸ºå¹¶å‘æƒ…å†µä¸‹æ’å…¥è¯­å¥çš„æ‰§è¡Œé¡ºåºå°±æ— æ³•å¾—åˆ°ä¿éšœã€‚

> å¦‚æœ MySQL é‡‡ç”¨çš„æ ¼å¼ä¸º Statement ï¼Œé‚£ä¹ˆ MySQL çš„ä¸»ä»åŒæ­¥å®é™…ä¸ŠåŒæ­¥çš„å°±æ˜¯ä¸€æ¡ä¸€æ¡çš„ SQL è¯­å¥ã€‚

æœ€åï¼Œå†æ¨èä¸€ç¯‡æ–‡ç« ï¼š[ä¸ºä»€ä¹ˆ MySQL çš„è‡ªå¢ä¸»é”®ä¸å•è°ƒä¹Ÿä¸è¿ç»­](https://draveness.me/whys-the-design-mysql-auto-increment/) ã€‚

## â­ï¸MySQL æ€§èƒ½ä¼˜åŒ–

å…³äº MySQL æ€§èƒ½ä¼˜åŒ–çš„å»ºè®®æ€»ç»“ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼š[MySQL é«˜æ€§èƒ½ä¼˜åŒ–è§„èŒƒå»ºè®®æ€»ç»“](./mysql-high-performance-optimization-specification-recommendations.md) ã€‚

### èƒ½ç”¨ MySQL ç›´æ¥å­˜å‚¨æ–‡ä»¶ï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼‰å—ï¼Ÿ

å¯ä»¥æ˜¯å¯ä»¥ï¼Œç›´æ¥å­˜å‚¨æ–‡ä»¶å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®å³å¯ã€‚ä¸è¿‡ï¼Œè¿˜æ˜¯å»ºè®®ä¸è¦åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶ï¼Œä¼šä¸¥é‡å½±å“æ•°æ®åº“æ€§èƒ½ï¼Œæ¶ˆè€—è¿‡å¤šå­˜å‚¨ç©ºé—´ã€‚

å¯ä»¥é€‰æ‹©ä½¿ç”¨äº‘æœåŠ¡å‚å•†æä¾›çš„å¼€ç®±å³ç”¨çš„æ–‡ä»¶å­˜å‚¨æœåŠ¡ï¼Œæˆç†Ÿç¨³å®šï¼Œä»·æ ¼ä¹Ÿæ¯”è¾ƒä½ã€‚

![](https://oss.javaguide.cn/github/javaguide/mysql/oss-search.png)

ä¹Ÿå¯ä»¥é€‰æ‹©è‡ªå»ºæ–‡ä»¶å­˜å‚¨æœåŠ¡ï¼Œå®ç°èµ·æ¥ä¹Ÿä¸éš¾ï¼ŒåŸºäº FastDFSã€MinIOï¼ˆæ¨èï¼‰ ç­‰å¼€æºé¡¹ç›®å°±å¯ä»¥å®ç°åˆ†å¸ƒå¼æ–‡ä»¶æœåŠ¡ã€‚

**æ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯ï¼Œæ–‡ä»¶ç”±æ–‡ä»¶å­˜å‚¨æœåŠ¡è´Ÿè´£å­˜å‚¨ã€‚**

### MySQL å¦‚ä½•å­˜å‚¨ IP åœ°å€ï¼Ÿ

å¯ä»¥å°† IP åœ°å€è½¬æ¢æˆæ•´å½¢æ•°æ®å­˜å‚¨ï¼Œæ€§èƒ½æ›´å¥½ï¼Œå ç”¨ç©ºé—´ä¹Ÿæ›´å°ã€‚

MySQL æä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç† ip åœ°å€

- `INET_ATON()`ï¼šæŠŠ ip è½¬ä¸ºæ— ç¬¦å·æ•´å‹ (4-8 ä½)
- `INET_NTOA()` :æŠŠæ•´å‹çš„ ip è½¬ä¸ºåœ°å€

æ’å…¥æ•°æ®å‰ï¼Œå…ˆç”¨ `INET_ATON()` æŠŠ ip åœ°å€è½¬ä¸ºæ•´å‹ï¼Œæ˜¾ç¤ºæ•°æ®æ—¶ï¼Œä½¿ç”¨ `INET_NTOA()` æŠŠæ•´å‹çš„ ip åœ°å€è½¬ä¸ºåœ°å€æ˜¾ç¤ºå³å¯ã€‚

### æœ‰å“ªäº›å¸¸è§çš„ SQL ä¼˜åŒ–æ‰‹æ®µï¼Ÿ

[ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹(ä»˜è´¹)](https://javaguide.cn/zhuanlan/java-mian-shi-zhi-bei.html) çš„ **ã€ŒæŠ€æœ¯é¢è¯•é¢˜ç¯‡ã€** æœ‰ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¸¸è§çš„ SQL ä¼˜åŒ–æ‰‹æ®µï¼Œéå¸¸å…¨é¢ï¼Œæ¸…æ™°æ˜“æ‡‚ï¼

![å¸¸è§çš„ SQL ä¼˜åŒ–æ‰‹æ®µ](https://oss.javaguide.cn/javamianshizhibei/javamianshizhibei-sql-optimization.png)

æ–‡ç« åœ°å€ï¼šhttps://www.yuque.com/snailclimb/mf2z3k/abc2sv ï¼ˆå¯†ç è·å–ï¼š<https://t.zsxq.com/avfM0>ï¼‰ã€‚

### å¦‚ä½•åˆ†æ SQL çš„æ€§èƒ½ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `EXPLAIN` å‘½ä»¤æ¥åˆ†æ SQL çš„ **æ‰§è¡Œè®¡åˆ’** ã€‚æ‰§è¡Œè®¡åˆ’æ˜¯æŒ‡ä¸€æ¡ SQL è¯­å¥åœ¨ç»è¿‡ MySQL æŸ¥è¯¢ä¼˜åŒ–å™¨çš„ä¼˜åŒ–ä¼šåï¼Œå…·ä½“çš„æ‰§è¡Œæ–¹å¼ã€‚

`EXPLAIN` å¹¶ä¸ä¼šçœŸçš„å»æ‰§è¡Œç›¸å…³çš„è¯­å¥ï¼Œè€Œæ˜¯é€šè¿‡ **æŸ¥è¯¢ä¼˜åŒ–å™¨** å¯¹è¯­å¥è¿›è¡Œåˆ†æï¼Œæ‰¾å‡ºæœ€ä¼˜çš„æŸ¥è¯¢æ–¹æ¡ˆï¼Œå¹¶æ˜¾ç¤ºå¯¹åº”çš„ä¿¡æ¯ã€‚

`EXPLAIN` é€‚ç”¨äº `SELECT`, `DELETE`, `INSERT`, `REPLACE`, å’Œ `UPDATE`è¯­å¥ï¼Œæˆ‘ä»¬ä¸€èˆ¬åˆ†æ `SELECT` æŸ¥è¯¢è¾ƒå¤šã€‚

æˆ‘ä»¬è¿™é‡Œç®€å•æ¥æ¼”ç¤ºä¸€ä¸‹ `EXPLAIN` çš„ä½¿ç”¨ã€‚

`EXPLAIN` çš„è¾“å‡ºæ ¼å¼å¦‚ä¸‹ï¼š

```sql
mysql> EXPLAIN SELECT `score`,`name` FROM `cus_order` ORDER BY `score` DESC;
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+
| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra          |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+
|  1 | SIMPLE      | cus_order | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 997572 |   100.00 | Using filesort |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+
1 row in set, 1 warning (0.00 sec)
```

å„ä¸ªå­—æ®µçš„å«ä¹‰å¦‚ä¸‹ï¼š

| **åˆ—å**      | **å«ä¹‰**                                     |
| ------------- | -------------------------------------------- |
| id            | SELECT æŸ¥è¯¢çš„åºåˆ—æ ‡è¯†ç¬¦                      |
| select_type   | SELECT å…³é”®å­—å¯¹åº”çš„æŸ¥è¯¢ç±»å‹                  |
| table         | ç”¨åˆ°çš„è¡¨å                                   |
| partitions    | åŒ¹é…çš„åˆ†åŒºï¼Œå¯¹äºæœªåˆ†åŒºçš„è¡¨ï¼Œå€¼ä¸º NULL        |
| type          | è¡¨çš„è®¿é—®æ–¹æ³•                                 |
| possible_keys | å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•                               |
| key           | å®é™…ç”¨åˆ°çš„ç´¢å¼•                               |
| key_len       | æ‰€é€‰ç´¢å¼•çš„é•¿åº¦                               |
| ref           | å½“ä½¿ç”¨ç´¢å¼•ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•ä½œæ¯”è¾ƒçš„åˆ—æˆ–å¸¸é‡ |
| rows          | é¢„è®¡è¦è¯»å–çš„è¡Œæ•°                             |
| filtered      | æŒ‰è¡¨æ¡ä»¶è¿‡æ»¤åï¼Œç•™å­˜çš„è®°å½•æ•°çš„ç™¾åˆ†æ¯”         |
| Extra         | é™„åŠ ä¿¡æ¯                                     |

ç¯‡å¹…é—®é¢˜ï¼Œæˆ‘è¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»äº†ä¸€ä¸‹ MySQL æ‰§è¡Œè®¡åˆ’ï¼Œè¯¦ç»†ä»‹ç»è¯·çœ‹ï¼š[SQL çš„æ‰§è¡Œè®¡åˆ’](./mysql-query-execution-plan.md)è¿™ç¯‡æ–‡ç« ã€‚

### è¯»å†™åˆ†ç¦»å’Œåˆ†åº“åˆ†è¡¨äº†è§£å—ï¼Ÿ

è¯»å†™åˆ†ç¦»å’Œåˆ†åº“åˆ†è¡¨ç›¸å…³çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œäºæ˜¯ï¼Œæˆ‘å•ç‹¬å†™äº†ä¸€ç¯‡æ–‡ç« æ¥ä»‹ç»ï¼š[è¯»å†™åˆ†ç¦»å’Œåˆ†åº“åˆ†è¡¨è¯¦è§£](../../high-performance/read-and-write-separation-and-library-subtable.md)ã€‚

### æ·±åº¦åˆ†é¡µå¦‚ä½•ä¼˜åŒ–ï¼Ÿ

[æ·±åº¦åˆ†é¡µä»‹ç»åŠä¼˜åŒ–å»ºè®®](../../high-performance/deep-pagination-optimization.md)

### æ•°æ®å†·çƒ­åˆ†ç¦»å¦‚ä½•åšï¼Ÿ

[æ•°æ®å†·çƒ­åˆ†ç¦»è¯¦è§£](../../high-performance/data-cold-hot-separation.md)

### MySQL æ€§èƒ½æ€ä¹ˆä¼˜åŒ–ï¼Ÿ

MySQL æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªç³»ç»Ÿæ€§å·¥ç¨‹ï¼Œæ¶‰åŠå¤šä¸ªæ–¹é¢ï¼Œåœ¨é¢è¯•ä¸­ä¸å¯èƒ½é¢é¢ä¿±åˆ°ã€‚å› æ­¤ï¼Œå»ºè®®æŒ‰ç…§â€œç‚¹-çº¿-é¢â€çš„æ€è·¯å±•å¼€ï¼Œä»æ ¸å¿ƒé—®é¢˜å…¥æ‰‹ï¼Œå†é€æ­¥æ‰©å±•ï¼Œå±•ç¤ºå‡ºä½ å¯¹é—®é¢˜çš„æ€è€ƒæ·±åº¦å’Œè§£å†³èƒ½åŠ›ã€‚

**1. æŠ“ä½æ ¸å¿ƒï¼šæ…¢ SQL å®šä½ä¸åˆ†æ**

æ€§èƒ½ä¼˜åŒ–çš„ç¬¬ä¸€æ­¥æ°¸è¿œæ˜¯æ‰¾åˆ°ç“¶é¢ˆã€‚é¢è¯•æ—¶ï¼Œå»ºè®®å…ˆä» **æ…¢ SQL å®šä½å’Œåˆ†æ** å…¥æ‰‹ï¼Œè¿™ä¸ä»…èƒ½å±•ç¤ºä½ è§£å†³é—®é¢˜çš„æ€è·¯ï¼Œè¿˜èƒ½ä½“ç°ä½ å¯¹æ•°æ®åº“æ€§èƒ½ç›‘æ§çš„ç†Ÿç»ƒæŒæ¡ï¼š

- **ç›‘æ§å·¥å…·ï¼š** ä»‹ç»å¸¸ç”¨çš„æ…¢ SQL ç›‘æ§å·¥å…·ï¼Œå¦‚ **MySQL æ…¢æŸ¥è¯¢æ—¥å¿—**ã€**Performance Schema** ç­‰ï¼Œè¯´æ˜ä½ å¯¹è¿™äº›å·¥å…·çš„ç†Ÿæ‚‰ç¨‹åº¦ä»¥åŠå¦‚ä½•é€šè¿‡å®ƒä»¬å®šä½é—®é¢˜ã€‚
- **EXPLAIN å‘½ä»¤ï¼š** è¯¦ç»†è¯´æ˜ `EXPLAIN` å‘½ä»¤çš„ä½¿ç”¨ï¼Œåˆ†ææŸ¥è¯¢è®¡åˆ’ã€ç´¢å¼•ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥ç»“åˆå®é™…æ¡ˆä¾‹å±•ç¤ºå¦‚ä½•è§£è¯»åˆ†æç»“æœï¼Œæ¯”å¦‚æ‰§è¡Œé¡ºåºã€ç´¢å¼•ä½¿ç”¨æƒ…å†µã€å…¨è¡¨æ‰«æç­‰ã€‚

**2. ç”±ç‚¹åŠé¢ï¼šç´¢å¼•ã€è¡¨ç»“æ„å’Œ SQL ä¼˜åŒ–**

å®šä½åˆ°æ…¢ SQL åï¼Œæ¥ä¸‹æ¥å°±è¦é’ˆå¯¹å…·ä½“é—®é¢˜è¿›è¡Œä¼˜åŒ–ã€‚ è¿™é‡Œå¯ä»¥é‡ç‚¹ä»‹ç»ç´¢å¼•ã€è¡¨ç»“æ„å’Œ SQL ç¼–å†™è§„èŒƒç­‰æ–¹é¢çš„ä¼˜åŒ–æŠ€å·§ï¼š

- **ç´¢å¼•ä¼˜åŒ–ï¼š** è¿™æ˜¯ MySQL æ€§èƒ½ä¼˜åŒ–çš„é‡ç‚¹ï¼Œå¯ä»¥ä»‹ç»ç´¢å¼•çš„åˆ›å»ºåŸåˆ™ã€è¦†ç›–ç´¢å¼•ã€æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ç­‰ã€‚å¦‚æœèƒ½ç»“åˆä½ é¡¹ç›®çš„å®é™…åº”ç”¨æ¥è¯´æ˜å¦‚ä½•é€‰æ‹©åˆé€‚çš„ç´¢å¼•ï¼Œä¼šæ›´åŠ åˆ†ä¸€äº›ã€‚
- **è¡¨ç»“æ„ä¼˜åŒ–ï¼š** ä¼˜åŒ–è¡¨ç»“æ„è®¾è®¡ï¼ŒåŒ…æ‹¬é€‰æ‹©åˆé€‚çš„å­—æ®µç±»å‹ã€é¿å…å†—ä½™å­—æ®µã€åˆç†ä½¿ç”¨èŒƒå¼å’ŒåèŒƒå¼è®¾è®¡ç­‰ç­‰ã€‚
- **SQL ä¼˜åŒ–ï¼š** é¿å…ä½¿ç”¨ `SELECT *`ã€å°½é‡ä½¿ç”¨å…·ä½“å­—æ®µã€ä½¿ç”¨è¿æ¥æŸ¥è¯¢ä»£æ›¿å­æŸ¥è¯¢ã€åˆç†ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢ã€æ‰¹é‡æ“ä½œç­‰ï¼Œéƒ½æ˜¯ SQL ç¼–å†™è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„ç»†èŠ‚ã€‚

**3. è¿›é˜¶æ–¹æ¡ˆï¼šæ¶æ„ä¼˜åŒ–**

å½“é¢è¯•å®˜å¯¹åŸºç¡€ä¼˜åŒ–çŸ¥è¯†æ¯”è¾ƒæ»¡æ„æ—¶ï¼Œå¯èƒ½ä¼šæ·±å…¥æ¢è®¨ä¸€äº›æ¶æ„å±‚é¢çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ¶æ„ä¼˜åŒ–ç­–ç•¥ï¼š

- **è¯»å†™åˆ†ç¦»ï¼š** å°†è¯»æ“ä½œå’Œå†™æ“ä½œåˆ†ç¦»åˆ°ä¸åŒçš„æ•°æ®åº“å®ä¾‹ï¼Œæå‡æ•°æ®åº“çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚
- **åˆ†åº“åˆ†è¡¨ï¼š** å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹æˆ–æ•°æ®è¡¨ä¸­ï¼Œé™ä½å•è¡¨æ•°æ®é‡ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚ä½†è¦æƒè¡¡å…¶å¸¦æ¥çš„å¤æ‚æ€§å’Œç»´æŠ¤æˆæœ¬ï¼Œè°¨æ…ä½¿ç”¨ã€‚
- **æ•°æ®å†·çƒ­åˆ†ç¦»**ï¼šæ ¹æ®æ•°æ®çš„è®¿é—®é¢‘ç‡å’Œä¸šåŠ¡é‡è¦æ€§ï¼Œå°†æ•°æ®åˆ†ä¸ºå†·æ•°æ®å’Œçƒ­æ•°æ®ï¼Œå†·æ•°æ®ä¸€èˆ¬å­˜å‚¨åœ¨ä½æˆæœ¬ã€ä½æ€§èƒ½çš„ä»‹è´¨ä¸­ï¼Œçƒ­æ•°æ®å­˜å‚¨åœ¨é«˜æ€§èƒ½å­˜å‚¨ä»‹è´¨ä¸­ã€‚
- **ç¼“å­˜æœºåˆ¶ï¼š** ä½¿ç”¨ Redis ç­‰ç¼“å­˜ä¸­é—´ä»¶ï¼Œå°†çƒ­ç‚¹æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå‡è½»æ•°æ®åº“å‹åŠ›ã€‚è¿™ä¸ªéå¸¸å¸¸ç”¨ï¼Œæå‡æ•ˆæœéå¸¸æ˜æ˜¾ï¼Œæ€§ä»·æ¯”æé«˜ï¼

**4. å…¶ä»–ä¼˜åŒ–æ‰‹æ®µ**

é™¤äº†æ…¢ SQL å®šä½ã€ç´¢å¼•ä¼˜åŒ–å’Œæ¶æ„ä¼˜åŒ–ï¼Œè¿˜å¯ä»¥æåŠä¸€äº›å…¶ä»–ä¼˜åŒ–æ‰‹æ®µï¼Œå±•ç¤ºä½ å¯¹ MySQL æ€§èƒ½è°ƒä¼˜çš„å…¨é¢ç†è§£ï¼š

- **è¿æ¥æ± é…ç½®ï¼š** é…ç½®åˆç†çš„æ•°æ®åº“è¿æ¥æ± ï¼ˆå¦‚ **è¿æ¥æ± å¤§å°**ã€**è¶…æ—¶æ—¶é—´** ç­‰ï¼‰ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæå‡æ•°æ®åº“è¿æ¥çš„æ•ˆç‡ï¼Œé¿å…é¢‘ç¹çš„è¿æ¥å¼€é”€ã€‚
- **ç¡¬ä»¶é…ç½®ï¼š** æå‡ç¡¬ä»¶æ€§èƒ½ä¹Ÿæ˜¯ä¼˜åŒ–çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ã€‚ä½¿ç”¨é«˜æ€§èƒ½æœåŠ¡å™¨ã€å¢åŠ å†…å­˜ã€ä½¿ç”¨ **SSD** ç¡¬ç›˜ç­‰ç¡¬ä»¶å‡çº§ï¼Œéƒ½å¯ä»¥æœ‰æ•ˆæå‡æ•°æ®åº“çš„æ•´ä½“æ€§èƒ½ã€‚

**5.æ€»ç»“**

åœ¨é¢è¯•ä¸­ï¼Œå»ºè®®æŒ‰ä¼˜å…ˆçº§ä¾æ¬¡ä»‹ç»æ…¢ SQL å®šä½ã€[ç´¢å¼•ä¼˜åŒ–](./mysql-index.md)ã€è¡¨ç»“æ„è®¾è®¡å’Œ [SQL ä¼˜åŒ–](../../high-performance/sql-optimization.md)ç­‰å†…å®¹ã€‚æ¶æ„å±‚é¢çš„ä¼˜åŒ–ï¼Œå¦‚[è¯»å†™åˆ†ç¦»å’Œåˆ†åº“åˆ†è¡¨](../../high-performance/read-and-write-separation-and-library-subtable.md)ã€[æ•°æ®å†·çƒ­åˆ†ç¦»](../../high-performance/data-cold-hot-separation.md) åº”ä½œä¸ºæœ€åçš„æ‰‹æ®µï¼Œé™¤éåœ¨ç‰¹å®šåœºæ™¯ä¸‹æœ‰æ˜æ˜¾çš„æ€§èƒ½ç“¶é¢ˆï¼Œå¦åˆ™ä¸åº”è½»æ˜“ä½¿ç”¨ï¼Œå› å…¶å¼•å…¥çš„å¤æ‚æ€§ä¼šå¸¦æ¥é¢å¤–çš„ç»´æŠ¤æˆæœ¬ã€‚

## MySQL å­¦ä¹ èµ„æ–™æ¨è

[**ä¹¦ç±æ¨è**](../../books/database.md#mysql) ã€‚

**æ–‡ç« æ¨è** :

- [ä¸€æ ‘ä¸€æºªçš„ MySQL ç³»åˆ—æ•™ç¨‹](https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3NTc3NjM4Nw==&action=getalbum&album_id=2372043523518300162&scene=173&from_msgid=2247484308&from_itemidx=1&count=3&nolastread=1#wechat_redirect)
- [Yes çš„ MySQL ç³»åˆ—æ•™ç¨‹](https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzkxNTE3NjQ3MA==&action=getalbum&album_id=1903249596194095112&scene=173&from_msgid=2247490365&from_itemidx=1&count=3&nolastread=1#wechat_redirect)
- [å†™å®Œè¿™ç¯‡ æˆ‘çš„ SQL ä¼˜åŒ–èƒ½åŠ›ç›´æ¥è¿›å…¥æ–°å±‚æ¬¡ - å˜æˆæ´¾å¤§æ˜Ÿ - 2022](https://juejin.cn/post/7161964571853815822)
- [ä¸¤ä¸‡å­—è¯¦è§£ï¼InnoDB é”ä¸“é¢˜ï¼ - æ¡ç”°èºçš„å°ç”·å­© - 2022](https://juejin.cn/post/7094049650428084232)
- [MySQL çš„è‡ªå¢ä¸»é”®ä¸€å®šæ˜¯è¿ç»­çš„å—ï¼Ÿ - é£å¤©å°ç‰›è‚‰ - 2022](https://mp.weixin.qq.com/s/qci10h9rJx_COZbHV3aygQ)
- [æ·±å…¥ç†è§£ MySQL ç´¢å¼•åº•å±‚åŸç† - è…¾è®¯æŠ€æœ¯å·¥ç¨‹ - 2020](https://zhuanlan.zhihu.com/p/113917726)

## å‚è€ƒ

- ã€Šé«˜æ€§èƒ½ MySQLã€‹ç¬¬ 7 ç«  MySQL é«˜çº§ç‰¹æ€§
- ã€ŠMySQL æŠ€æœ¯å†…å¹• InnoDB å­˜å‚¨å¼•æ“ã€‹ç¬¬ 6 ç«  é”
- Relational Databaseï¼š<https://www.omnisci.com/technical-glossary/relational-database>
- ä¸€ç¯‡æ–‡ç« çœ‹æ‡‚ mysql ä¸­ varchar èƒ½å­˜å¤šå°‘æ±‰å­—ã€æ•°å­—ï¼Œä»¥åŠ varchar(100)å’Œ varchar(10)çš„åŒºåˆ«ï¼š<https://www.cnblogs.com/zhuyeshen/p/11642211.html>
- Technology sharing | Isolation level: Correct understanding of phantom reading: <https://opensource.actionsky.com/20210818-mysql/>
- MySQL Server Logs - MySQL 5.7 Reference Manual: <https://dev.mysql.com/doc/refman/5.7/en/server-logs.html>
- Redo Log - MySQL 5.7 Reference Manual: <https://dev.mysql.com/doc/refman/5.7/en/innodb-redo-log.html>
- Locking Reads - MySQL 5.7 Reference Manual: <https://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html>
- In-depth understanding of database row locks and table locks <https://zhuanlan.zhihu.com/p/52678870>
- Detailed explanation of the role of intention locks in MySQL InnoDB: <https://juejin.cn/post/6844903666332368909>
- In-depth analysis of MySQL self-increasing lock: <https://juejin.cn/post/6968420054287253540>
- How should non-repeatable reads and phantom reads be distinguished in the database? ï¼š<https://www.zhihu.com/question/392569386>

<!-- @include: @article-footer.snippet.md -->